import{d as w,I as C,c2 as P,K as f,N as R,a9 as A,t as M,ab as T,q as y,O as h,_ as $,r as D,o as E,c as I,w as N,b as F}from"./index-LcKkVeBi.js";import{D as k}from"./ReportDateSelectionPrompt-atX-EAfC.js";import{T as q}from"./tx_report_service-d-3IwJIH.js";import{v as S}from"./TableView-1ICxUnND.js";import{A as x}from"./ArtDrilldown-CKdLy1tE.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./MultiFieldDateHelper-a0G5uGB9.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./PopupKeyboard-iGZRraXb.js";import"./SIngleTouchField-3M9HluW_.js";import"./TouchScreenForm-xHVNtrEx.js";import"./ToolbarMediumCard-8zGLRwn9.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-bfGE2-21.js";import"./HisKeypad-MSTDfmtj.js";import"./BaseKeyboard-QLDFRK8q.js";import"./KbHandler-oqPdZ1-Q.js";import"./overlays-3311e70e-enepUbX6.js";import"./fuse-lCMBsAWg.js";import"./Export-6ZtfPpq7.js";import"./HisKeyboard-eull0vVi.js";import"./person_service-u0P3oBQh.js";const B=w({components:{IonPage:C,IonLoading:P,v2Datatable:S},setup(){const t=f([]),c=f(""),p=f(!1),s=new q;function n(r,g){return{ref:g,label:r,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await h.create({component:x,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label),patientIdentifiers:e.refData,onFinish:()=>h.getTop().then(d=>d&&h.dismiss())}})).present()}}}const b=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},n("CD4 <200","cd4_less_than_200"),n("CD4 >=200","cd4_greater_than_or_equal_to_200"),n("Unknown CD4","unknown_cd4_count"),n("Not Eligible for CD4","not_eligible_for_cd4"),n("Returned <3 mo","returned_less_than_3_months"),n("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),n("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],u=async()=>{s.startDate&&s.endDate||M("Start date and end date required!"),p.value=!0;try{const r=await s.getTxRttReport(),g={F:"Female",M:"Male"},e=r.reduce((a,o)=>(o.age_group!="Unknown"&&(a[o.gender].rows.push({...o,gender:g[o.gender]}),a[o.gender].aggregate=Object.keys(o).reduce((i,l)=>Array.isArray(o[l])?{...i,[l]:[...i[l]||[],...o[l]]}:i,a[o.gender].aggregate)),a),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});t.value=[...e.F.rows,...e.M.rows,{age_group:"All",gender:"Male",...e.M.aggregate}];const d=Object.values(e.F.aggregate).flat(1),_=await s.getMaternalStatus(T.uniq(d)),v=_.FBf.concat(_.FP);["FP","FNP","FBf"].forEach(a=>{t.value.push(Object.keys(e.F.aggregate).reduce((o,i)=>({...o,[i]:e.F.aggregate[i].filter(l=>a==="FNP"?!v.includes(l):_[a].includes(l))}),{age_group:"All",gender:a}))}),t.value=t.value.map((a,o)=>({index:o+1,...a}))}catch(r){console.error(r),y("Unable to generate report!")}p.value=!1},m=()=>k({onFinish:(r,g,e)=>{c.value=e,s.startDate=r,s.endDate=g,u()}});return R(()=>m()),{reportData:t,isLoading:p,Img:A,configure:m,generate:u,columns:b,period:c}}});function O(t,c,p,s,n,b){const u=D("ion-loading"),m=D("v2Datatable"),r=D("ion-page");return E(),I(r,null,{default:N(()=>[F(u,{"is-open":t.isLoading,message:"Please wait..."},null,8,["is-open"]),F(m,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":t.Img("login-logos/PEPFAR.png"),subtitle:t.period,columns:t.columns,columnData:t.reportData,rowsPerPage:100,onConfigure:t.configure,onRefresh:()=>t.generate()},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const ge=$(B,[["render",O]]);export{ge as default};
