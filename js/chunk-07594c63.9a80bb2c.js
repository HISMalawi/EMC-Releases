(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07594c63"],{"113a":function(e,t,n){},"13d5":function(e,t,n){"use strict";var r=n("23e7"),a=n("d58f").left,i=n("a640"),o=n("ae40"),u=n("2d00"),c=n("605d"),s=i("reduce"),l=o("reduce",{1:0}),d=!c&&u>79&&u<83;r({target:"Array",proto:!0,forced:!s||!l||d},{reduce:function(e){return a(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"1c3d":function(e,t,n){},"5f2c":function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n("1da1"),a=n("d4ec"),i=n("bee2"),o=n("262e"),u=n("2caf"),c=(n("d81d"),n("d3b7"),n("3ca3"),n("ddb0"),n("4e82"),n("96cf"),n("cc6f")),s=n("71c3"),l=(n("13d5"),n("1c74"));class d extends l["e"]{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(t&&t.length>0)return t.reduce((e,t)=>e+t.current_quantity,0)}}var p=n("d1ca"),f={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[30,60,90],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,12]},h=function(e){Object(o["a"])(n,e);var t=Object(u["a"])(n);function n(e,r){var i;return Object(a["a"])(this,n),i=t.call(this,e,54,r),i.drugHistory=[],i.currentDrugOrder=[],i.useDrugManagement=!1,i}return Object(i["a"])(n,[{key:"setIsDrugManagementEnabled",value:function(e){this.useDrugManagement=e}},{key:"loadDrugManagementEnabled",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["b"].drugManagementEnabled();case 2:this.useDrugManagement=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDrugHistory",value:function(){return this.drugHistory}},{key:"getCurrentOrder",value:function(){return this.currentDrugOrder}},{key:"buildDispensations",value:function(e,t,n){for(var r=[],a=0;a<n;a++)r.push({drug_order_id:e,date:this.date,quantity:t/n});return r}},{key:"saveDispensations",value:function(e){return c["a"].postJson("/dispensations",{dispensations:e,program_id:c["a"].getProgramID()})}},{key:"voidOrder",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",c["a"].void("/dispensations/".concat(t),{}));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadDrugHistory",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s["a"].getDrugOrderHistory(this.patientID);case 3:t=e.sent,t&&(this.drugHistory=t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.warn(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCurrentDrugOrder",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s["a"].getDrugOrders(this.patientID);case 2:if(t=e.sent,!t){e.next=11;break}if(!this.useDrugManagement){e.next=10;break}return n=t.map(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d.fetchAvailableDrugStock(t.drug.drug_id);case 2:return t["available_stock"]=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=8,Promise.all(n);case 8:return this.currentDrugOrder=e.sent,e.abrupt("return");case 10:this.currentDrugOrder=t;case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDrugPackSizes",value:function(e){return e in f?f[e]:[30,60,90]}},{key:"calcCompletePack",value:function(e,t){var n=e.barcodes.sort((function(e,t){return e.tabs-t.tabs}));if(0==n.length||0==t)return t;for(var r in n){var a=n[r].tabs;if(parseInt(a)>=t)return a}var i=parseInt(n[n.length-1].tabs);return i}}]),n}(c["a"])},"6c3f":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var u=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(u,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}var i=n("5530"),o=n("53ca"),u=n("2909"),c=n("1da1"),s=(n("96cf"),n("4de4"),n("d3b7"),n("3ca3"),n("ddb0"),n("99af"),n("ac1f"),n("466d"),n("d81d"),n("caad"),n("2532"),n("b0c0"),n("a9e3"),n("b64b"),n("07ac"),n("d95e")),l=n("7920"),d=n("2706"),p=n("b5e4"),f=n("9283"),h=n("2ef0"),b=n("3b8c"),g=n("c1e4"),m=n("9b7c"),v=n("8158"),O=n("fe96"),y=n("8a30");const x=Object(r["withScopeId"])("data-v-10a26cd2");Object(r["pushScopeId"])("data-v-10a26cd2");const T=Object(r["createTextVNode"])("VL milestone has been reached"),_=Object(r["createTextVNode"])(" Order VL"),C=Object(r["createTextVNode"])(" Wait till next milestone"),w=Object(r["createTextVNode"])(" Remind me later ");Object(r["popScopeId"])();const k=x((function(e,t,n,a,i,o){const u=Object(r["resolveComponent"])("ion-title"),c=Object(r["resolveComponent"])("ion-toolbar"),s=Object(r["resolveComponent"])("ion-header"),l=Object(r["resolveComponent"])("ion-content"),d=Object(r["resolveComponent"])("ion-button"),p=Object(r["resolveComponent"])("ion-footer");return Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,[Object(r["createVNode"])(s,null,{default:x(()=>[Object(r["createVNode"])(c,null,{default:x(()=>[Object(r["createVNode"])(u,null,{default:x(()=>[T]),_:1})]),_:1})]),_:1}),Object(r["createVNode"])(l,{style:{overflowY:"hidden",background:"grey"}},{default:x(()=>[Object(r["createVNode"])("p",null,"ART start date : "+Object(r["toDisplayString"])(e.artStartDate),1),Object(r["createVNode"])("p",null,"Months on ART: "+Object(r["toDisplayString"])(e.monthsOnART),1),Object(r["createVNode"])("p",null,"Last VL order date "+Object(r["toDisplayString"])(e.lastOrder),1),Object(r["createVNode"])("p",null,"Current regimen / start date: "+Object(r["toDisplayString"])(e.currentRegimen)+" - "+Object(r["toDisplayString"])(e.regimenStartDate),1)]),_:1}),Object(r["createVNode"])(p,null,{default:x(()=>[Object(r["createVNode"])(c,null,{default:x(()=>[Object(r["createVNode"])(d,{slot:"end",color:"success",size:"large",onClick:t[1]||(t[1]=t=>e.closeModal("order"))},{default:x(()=>[_]),_:1}),Object(r["createVNode"])(d,{slot:"end",size:"large",onClick:t[2]||(t[2]=t=>e.closeModal("wait"))},{default:x(()=>[C]),_:1}),Object(r["createVNode"])(d,{slot:"start",color:"danger",size:"large",onClick:t[3]||(t[3]=t=>e.closeModal("later"))},{default:x(()=>[w]),_:1})]),_:1})]),_:1})],64)}));var j=Object(r["defineComponent"])({name:"Modal",props:{VLData:{type:Object,required:!0}},async created(){this.artStartDate=f["b"].toStandardHisDisplayFormat(this.VLData.earliest_start_date),this.monthsOnART=this.VLData.period_on_art,this.lastOrder=this.VLData.last_order_date?f["b"].toStandardHisDisplayFormat(this.VLData.last_order_date):"N/A",this.currentRegimen=this.VLData.current_regimen.name?this.VLData.current_regimen.name:"Other",this.regimenStartDate=f["b"].toStandardHisDisplayFormat(this.VLData.current_regimen.date_started)},methods:{async closeModal(e){await y["X"].dismiss(e)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:y["q"],IonToolbar:y["Q"],IonTitle:y["P"],IonContent:y["n"],IonFooter:y["o"],IonButton:y["d"]}}),R=(n("d42f"),n("6b0d")),D=n.n(R);const P=D()(j,[["render",k],["__scopeId","data-v-10a26cd2"]]);var S=P,E=n("ad60"),I=n("cc6f");class N extends I["a"]{constructor(e,t){super(e,13,t)}async buildDefferedOrder(e){const t=await I["a"].getConceptID("HIV viral load"),n=await I["a"].getConceptID("Delayed milestones");return[{concept_id:t,value_text:"Wait till next milestone",value_coded:n,value_numeric:e}]}}var V=n("7f35");const A=Object(r["withScopeId"])("data-v-546674a2");Object(r["pushScopeId"])("data-v-546674a2");const F=Object(r["createTextVNode"])("Side effects suspected causes"),H={style:{}},B=Object(r["createVNode"])("div",{class:"side-title"}," Select reason ",-1),L=Object(r["createVNode"])("p",null,"Current Medication",-1),M=Object(r["createVNode"])("p",null,"Previous Medication",-1),q=Object(r["createTextVNode"])("Other, not drug related"),U=Object(r["createTextVNode"])("Drug side effect"),W=Object(r["createVNode"])("p",null,null,-1),Y=Object(r["createTextVNode"])(" Close "),z=Object(r["createTextVNode"])(" Save ");Object(r["popScopeId"])();const G=A((function(e,t,n,a,i,o){const u=Object(r["resolveComponent"])("ion-title"),c=Object(r["resolveComponent"])("ion-toolbar"),s=Object(r["resolveComponent"])("ion-header"),l=Object(r["resolveComponent"])("ion-label"),d=Object(r["resolveComponent"])("ion-item"),p=Object(r["resolveComponent"])("ion-list"),f=Object(r["resolveComponent"])("ion-col"),h=Object(r["resolveComponent"])("ion-radio"),b=Object(r["resolveComponent"])("ion-radio-group"),g=Object(r["resolveComponent"])("ion-row"),m=Object(r["resolveComponent"])("ion-grid"),v=Object(r["resolveComponent"])("ion-content"),O=Object(r["resolveComponent"])("ion-button"),y=Object(r["resolveComponent"])("ion-footer");return Object(r["openBlock"])(),Object(r["createBlock"])(r["Fragment"],null,[Object(r["createVNode"])(s,null,{default:A(()=>[Object(r["createVNode"])(c,null,{default:A(()=>[Object(r["createVNode"])(u,null,{default:A(()=>[F]),_:1})]),_:1})]),_:1}),Object(r["createVNode"])(v,{style:{overflowY:"hidden",background:"grey"}},{default:A(()=>[Object(r["createVNode"])(m,null,{default:A(()=>[Object(r["createVNode"])(g,null,{default:A(()=>[Object(r["createVNode"])(f,{size:"4"},{default:A(()=>[Object(r["createVNode"])(p,{style:{overflowY:"auto",height:"78vh"}},{default:A(()=>[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sides,(t,n)=>(Object(r["openBlock"])(),Object(r["createBlock"])(d,{key:t,onClick:t=>e.selectSideEffect(n),detail:!0,style:e.activeIndex===n?"color: green":"color: black"},{default:A(()=>[Object(r["createVNode"])(l,null,{default:A(()=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.label),1)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1})]),_:1}),Object(r["createVNode"])(f,{style:{overflowY:"auto",height:"78vh"}},{default:A(()=>[Object(r["createVNode"])("div",H,[Object(r["createVNode"])(p,null,{default:A(()=>[null!==e.activeIndex?(Object(r["openBlock"])(),Object(r["createBlock"])(b,{key:0,modelValue:e.sides[e.activeIndex]["reason"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.sides[e.activeIndex]["reason"]=t)},{default:A(()=>[B,L,(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.drugs,(e,t)=>(Object(r["openBlock"])(),Object(r["createBlock"])(d,{key:t},{default:A(()=>[Object(r["createVNode"])(l,null,{default:A(()=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.drug.name),1)]),_:2},1024),Object(r["createVNode"])(h,{slot:"start",value:e.drug_inventory_id},null,8,["value"])]),_:2},1024))),128)),M,Object(r["createVNode"])(d,null,{default:A(()=>[Object(r["createVNode"])(l,null,{default:A(()=>[q]),_:1}),Object(r["createVNode"])(h,{slot:"start",value:"other"})]),_:1}),Object(r["createVNode"])(d,null,{default:A(()=>[Object(r["createVNode"])(l,null,{default:A(()=>[U]),_:1}),Object(r["createVNode"])(h,{slot:"start",value:"drug"})]),_:1})]),_:1},8,["modelValue"])):Object(r["createCommentVNode"])("",!0)]),_:1})]),W]),_:1})]),_:1})]),_:1})]),_:1}),Object(r["createVNode"])(y,null,{default:A(()=>[Object(r["createVNode"])(c,null,{default:A(()=>[Object(r["createVNode"])(O,{onClick:e.closeModal,slot:"end",color:"danger"},{default:A(()=>[Y]),_:1},8,["onClick"]),Object(r["createVNode"])(O,{onClick:e.postSideEffects,slot:"end",disabled:!e.allSelected},{default:A(()=>[z]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})],64)}));var J=Object(r["defineComponent"])({name:"Modal",props:{sideEffects:{type:Object,required:!0},drugs:{type:Array,default:[]}},methods:{closeModal(){y["X"].dismiss()},async postSideEffects(){await y["X"].dismiss(this.sides)},selectSideEffect(e){this.activeIndex=e}},computed:{allSelected(){return this.sides.filter(e=>e["reason"]).length===this.sides.length}},mounted(){this.sides=this.sideEffects},data(){return{content:"Content",extendedLabsEnabled:!1,appActivities:[],sides:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}},components:{IonButton:y["d"],IonContent:y["n"],IonHeader:y["q"],IonTitle:y["P"],IonToolbar:y["Q"],IonLabel:y["x"],IonList:y["y"],IonItem:y["w"],IonRadioGroup:y["F"],IonRow:y["H"]}});n("e96c");const X=D()(J,[["render",G],["__scopeId","data-v-546674a2"]]);var Q=X,K=n("d1ca"),Z=n("b446"),$=n("9ceb"),ee=n("8df6"),te=n("dac2"),ne=n("5f2c"),re=n("4db7"),ae=n("8e8b"),ie=Object(r["defineComponent"])({mixins:[O["a"]],components:{HisStandardForm:l["a"]},data:function(){return{fields:[],currentWeight:-1,weightTrail:[],customRegimens:[],labOrders:[],weightLossPercentageNum:0,lostTenPercentBodyWeight:!1,CxCaEnabled:!1,CxCaStartAge:-1,CxCaMaxAge:-1,DueForCxCa:!1,currentlyPregnant:!1,patientHitMenopause:!1,hasPregnancyObsToday:!1,autoSelect3HP:!1,labOrderFieldContext:{},consultation:{},prescription:{},dispensation:{},completed3HP:!1,hasTbHistoryObs:!1,allergicToSulphur:!1,TBSuspected:!1,presentedTBSymptoms:!1,askAdherence:!1,lastDrugsReceived:[],sideEffectsHistory:{},onPermanentFPMethods:!1,reasonForDecliningTPTObs:{},malawiSideEffectReasonObs:[],otherSideEffectReasonObs:[],wasTransferredIn:!1,dateStartedArt:"",clientHadAHysterectomy:!1,isNoneClientPatient:!1}},watch:{ready:{handler:function(e){e&&(this.consultation=new b["a"](this.patientID,this.providerID),this.prescription=new te["a"](this.patientID,this.providerID),this.dispensation=new ne["a"](this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{onFinish:function(e,t){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var a,i,o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.consultation.createEncounter();case 2:if(a=r.sent,a){r.next=5;break}return r.abrupt("return",Object(p["e"])("Unable to create encounter"));case 5:return r.next=7,n.resolveObs(t,"consultation");case 7:return i=r.sent,r.next=10,Promise.all([].concat(Object(u["a"])(n.malawiSideEffectReasonObs),Object(u["a"])(n.otherSideEffectReasonObs),[n.reasonForDecliningTPTObs]));case 10:return o=r.sent.filter((function(e){return!Object(h["isEmpty"])(e)})),r.next=13,n.consultation.saveObservationList([].concat(Object(u["a"])(i),Object(u["a"])(o)));case 13:if(c=r.sent,Object(h["isEmpty"])(n.drugObs)||n.isNoneClientPatient){r.next=17;break}return r.next=17,n.saveAdherence();case 17:if(c){r.next=19;break}return r.abrupt("return",Object(p["e"])("Unable to save patient observations"));case 19:if(Object(p["d"])("Observations and encounter created!"),!e.refer_to_clinician||"Yes"!==e.refer_to_clinician.value){r.next=23;break}return n.gotoPatientDashboard(),r.abrupt("return");case 23:n.nextTask();case 24:case"end":return r.stop()}}),r)})))()},getTransferInStatus:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b["a"].getFirstValueCoded(e.patientID,"Ever received ART");case 2:return n=t.sent,t.next=5,b["a"].getFirstObs(e.patientID,"Has transfer letter");case 5:return r=t.sent,a=r?f["b"].toStandardHisFormat(r.obs_datetime):"",t.abrupt("return",n&&n.match(/yes/i)&&r&&"".concat(r.value_coded).match(/yes/i)&&a===e.consultation.getDate());case 8:case"end":return t.stop()}}),t)})))()},getDateStartedArt:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b["a"].getFirstValueDatetime(e.patientID,"Date ART started");case 2:return n=t.sent,t.abrupt("return",n?f["b"].toStandardHisFormat(n):"");case 4:case"end":return t.stop()}}),t)})))()},checkIfWeightLossIsControlled:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(t.lostTenPercentBodyWeight&&"".concat(e.label).match(/malnutrition/i)&&"".concat(e.value).match(/no/i))){n.next=5;break}return n.next=3,Object(V["a"])("Recommendation","Patient's weight has dropped by ".concat(t.weightLossPercentageNum,"% , is this controlled weight loss??"),"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);case 3:r=n.sent,e.value="Confirm weight loss"===r?"Yes":"No";case 5:case"end":return n.stop()}}),n)})))()},checkVLReminder:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,E["a"].getPatientVLInfo(e.patientID);case 2:if(n=t.sent,!0!==n.eligibile){t.next=23;break}return t.next=6,y["X"].create({component:S,backdropDismiss:!1,cssClass:"large-modal",componentProps:{VLData:n}});case 6:return r=t.sent,r.present(),t.next=10,r.onDidDismiss();case 10:a=t.sent,i=a.data,t.t0=i,t.next="order"===t.t0?15:"wait"===t.t0?18:"later"===t.t0?21:22;break;case 15:return t.next=17,e.labOrderFieldContext.launchOrderSelection();case 17:return t.abrupt("break",23);case 18:return t.next=20,e.waitForVL();case 20:return t.abrupt("break",23);case 21:return t.abrupt("break",23);case 22:return t.abrupt("break",23);case 23:case"end":return t.stop()}}),t)})))()},waitForVL:function(){var e=arguments,t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:null,a=new N(t.patientID,t.providerID),n.next=4,a.createEncounter();case 4:return i=n.sent,n.next=7,a.buildDefferedOrder(r);case 7:if(o=n.sent,i){n.next=10;break}return n.abrupt("return",Object(p["e"])("Unable to create encounter"));case 10:return n.next=12,a.saveObservationList(o);case 12:case"end":return n.stop()}}),n)})))()},canScreenCxCa:function(){var e=this.patient.getAge();return this.patient.isFemale()&&this.DueForCxCa&&this.CxCaEnabled&&e>=this.CxCaStartAge&&e<=this.CxCaMaxAge&&!this.clientHadAHysterectomy},pregnancyEligible:function(){return this.patient.isChildBearing()&&!this.onPermanentFPMethods},showCurrentContraceptionMethods:function(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isANCclient()},showNewContraceptionMethods:function(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isOnTubalLigation(e)&&!this.isANCclient()},isPregnant:function(e){return e.pregnant_breastfeeding?this.inArray(e.pregnant_breastfeeding,(function(e){return"Pregnant"===e.label&&"Yes"===e.value})):this.currentlyPregnant},isOnTubalLigation:function(e){return this.inArray(e.current_fp_methods,(function(e){return"TUBAL LIGATION"===e.value}))},disableFPMethods:function(e,t){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.isChecked||"NONE"!==t.label){r.next=4;break}return r.abrupt("return",e.map((function(e){return"NONE"!=e.label&&(e.isChecked=!1,e.disabled=!1),e})));case 4:if("NONE"==t.label||!t.isChecked){r.next=14;break}return t.label.match(/condom/gi)&&Object(p["b"])("Combine with other modern methods of family planning"),a=Object(h["findIndex"])(e,{label:"NONE"}),e[a].isChecked=!1,i=n.consultation.familyPlanningMethods(t.label,e),o=Object(h["findIndex"])(i,{label:t.label}),i[o].isChecked=!0,r.abrupt("return",i);case 14:return r.abrupt("return",e.map((function(e){return e.disabled=!1,e})));case 15:case"end":return r.stop()}}),r)})))()},disablePrescriptions:function(e,t){if(t.isChecked&&"NONE OF THE ABOVE"===t.label)return e.map((function(e){return"NONE OF THE ABOVE"!=e.label&&(e.isChecked=!1),e}));if("NONE OF THE ABOVE"!=t.label&&t.isChecked){var n=Object(h["findIndex"])(e,{label:"NONE OF THE ABOVE"});e[n].isChecked=!1}return e},buildMedicationOrders:function(e){var t=this;if(this.inArray(e,(function(e){return"NONE OF THE ABOVE"===e.label})))return this.consultation.buildValueCoded("Prescribe drugs","No");var n=this.consultation.buildValueCoded("Prescribe drugs","Yes"),r=e.map((function(e){return t.consultation.buildValueCoded("Medication orders",e.label)}));return[n].concat(Object(u["a"])(r))},declinedFPM:function(e){return this.inArray(e.fp_methods,(function(e){return"NONE"===e.value}))&&this.inArray(e.current_fp_methods,(function(e){return"NONE"===e.value}))},riskOfUnplannedPregnancy:function(e){return"At risk of unplanned pregnancy"===e.reason_for_no_fpm.value},showOtherSideEffects:function(e){return this.inArray(e.side_effects,(function(e){return"Other"===e.label&&"Yes"===e.value}))},hasTBSymptoms:function(e){return this.presentedTBSymptoms=this.inArray(e.tb_side_effects,(function(e){return"Yes"===e.value})),this.presentedTBSymptoms},buildSideEffectObs:function(e,t){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n.getSideEffectsReasons(e);case 2:if(a=r.sent,n[t]=[],void 0!==a){r.next=6;break}return r.abrupt("return",!1);case 6:return-1!=a&&(i=v["a"].getCachedConceptID("Drug induced",!0),o=function(e){return!!"".concat(e).match(/other|drug/i)},n[t]=a.map((function(e){return{concept_id:i,value_coded:v["a"].getCachedConceptID(e.label,!0),value_text:o(e.reason)?"Past medication history":null,value_drug:o(e.reason)?null:e.reason}}))),r.abrupt("return",!0);case 8:case"end":return r.stop()}}),r)})))()},getSideEffectsReasons:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.filter((function(e){return!"".concat(e.label).match(/other/i)&&"Yes"===e.value})),!(r.length>0)){n.next=11;break}return n.next=4,y["X"].create({component:Q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:r,drugs:t.lastDrugsReceived}});case 4:return a=n.sent,a.present(),n.next=8,a.onDidDismiss();case 8:return i=n.sent,o=i.data,n.abrupt("return",o);case 11:return n.abrupt("return",-1);case 12:case"end":return n.stop()}}),n)})))()},getFPMethods:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.consultation.getFamilyPlanningMethods(),r=n.filter((function(t){return!e.includes(t)}));return r.map((function(e){return{label:e,value:e,isChecked:t.map((function(e){return e.label})).includes(e)}}))},getOptions:function(e,t){var n=this;return e.map((function(e){var r=Object(h["find"])(t,{label:e});return{label:e,value:r?r.value:"",other:{values:n.yesNoOptions()}}}))},getContraindications:function(e){var t=v["a"].getConceptsByCategory("contraindication",!0).map((function(e){return e.name}));return this.getOptions([].concat(Object(u["a"])(t),["Other"]),e)},getOtherContraindications:function(e){var t=v["a"].getConceptsByCategory("side_effect",!0).map((function(e){return e.name})),n=t.pop();return this.getOptions([].concat(Object(u["a"])(t),["Other (Specify)","".concat(n)]),e)},getTBSymptoms:function(e){var t=v["a"].getConceptsByCategory("tb_symptom",!0).map((function(e){return e.name}));return this.getOptions(Object(u["a"])(t),e)},getReasonsForNoCxcaOptions:function(){return v["a"].getConceptsByCategory("reason_for_no_cxca").map((function(e){return{label:e.name,value:e.name,other:{c:e}}}))},runAppendOptionParams:function(e,t){var n=t.filter((function(e){return e.isChecked})).map((function(e){return e.label}));return e.map((function(e){var t;if("function"===typeof(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.appendOptionParams)){var r,a=null===e||void 0===e||null===(r=e.other)||void 0===r?void 0:r.appendOptionParams();if("object"===Object(o["a"])(a)){var u={label:e.label,value:e.value,other:e.other};return a.isChecked?(u.isChecked=a.isChecked,delete a.isChecked):u.isChecked=n.includes(e.label),Object(i["a"])(Object(i["a"])({},u),a)}}return e}))},didCompleted3HP:function(e){return!!this.completed3HP||!(!e.routine_tb_therapy||!e.routine_tb_therapy.value.match(/complete/i))},tptAutoSelectionMode:function(e){return this.autoSelect3HP&&!this.didCompleted3HP(e)},on3HPValueUpdate:function(e,t,n){var r=this;return Object(c["a"])(regeneratorRuntime.mark((function a(){var i,o,u,c,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=function(e){return!!e.label.match(/IPT|3HP/i)},o=function(){var t=e.reduce((function(e,t){return i(t)&&!(t.label in e)&&t.isChecked&&e.push(t.label),e}),[]);return t.includes("IPT")&&(t.includes("3HP (RFP + INH)")||t.includes("INH 300 / RFP 300 (3HP)"))}(),u=i(t)&&e.filter((function(e){return i(e)})).map((function(e){return!e.isChecked})).every(Boolean),!u||!r.tptAutoSelectionMode(n)){a.next=10;break}return a.next=6,Object(V["c"])("Reasons for declining TPT","",["Patient declined","Side-effects (previous or current)","Stock-out","Starting TB treatment","Other"],[{name:"Done",slot:"start",role:"action"}]);case 6:c=a.sent,r.reasonForDecliningTPTObs=r.consultation.buildValueText("Other reason for not seeking services",c.selection),a.next=11;break;case 10:r.reasonForDecliningTPTObs={};case 11:if(!o){a.next=16;break}return a.next=14,Object(V["a"])("IPT / 3HP conflict","IPT and 3HP can NOT be prescribed together","Please pick either one",[{name:"Prescribe 3HP",slot:"start",color:"primary"},{name:"Prescribe IPT",slot:"end",color:"primary"}]);case 14:return s=a.sent,a.abrupt("return",e.map((function(e){return i(e)&&(e.isChecked="Prescribe IPT"===s&&"IPT"===e.label||"Prescribe 3HP"===s&&"INH 300 / RFP 300 (3HP)"===e.label),e})));case 16:return a.abrupt("return",e.map((function(e){return("3HP (RFP + INH)"===t.label&&"INH 300 / RFP 300 (3HP)"===e.label&&t.isChecked||"INH 300 / RFP 300 (3HP)"===t.label&&"3HP (RFP + INH)"===e.label&&t.isChecked)&&(e.isChecked=!1),e})));case 17:case"end":return a.stop()}}),a)})))()},medicationOrderOptions:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this.didCompleted3HP(e),a=this.tptAutoSelectionMode(e),i=function(e){return{disabled:!0,isChecked:!1,description:{color:"danger",show:"always",text:e}}};return this.runAppendOptionParams([this.toOption("ARVs",{appendOptionParams:function(){return{isChecked:a&&!t.TBSuspected}}}),this.toOption("CPT",{appendOptionParams:function(){return!a||t.TBSuspected||t.allergicToSulphur?t.allergicToSulphur?i("Allergic to CPT"):{disabled:!1}:{isChecked:!0}}}),this.toOption("3HP (RFP + INH)",{appendOptionParams:function(){return r?i("Completed 3HP"):t.TBSuspected?i("TB Suspect"):t.currentWeight<20?i("Weight below regulation"):void 0}}),this.toOption("INH 300 / RFP 300 (3HP)",{appendOptionParams:function(){return r?i("Completed 3HP"):t.TBSuspected?i("TB Suspect"):t.currentWeight<30?i("Weight below regulation"):{isChecked:a}}}),this.toOption("IPT",{appendOptionParams:function(){return r?i("Completed 3HP"):t.TBSuspected?i("TB Suspect"):void 0}}),this.toOption("NONE OF THE ABOVE")],n)},getVlLabData:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=m["a"],t.next=3,ae["a"].get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:e.patientID});case 3:return t.t1=t.sent,t.abrupt("return",t.t0.formatLabs.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))()},isANCclient:function(){return"ANC"===E["a"].getSuspendedProgram()},getFields:function(){var e=this;return[{id:"other_patient_prescription",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.consultation.getClient();case 2:if(t.t0=t.sent,n="No"===t.t0,!n){t.next=8;break}e.isNoneClientPatient=!0,t.next=16;break;case 8:return t.next=10,ee["a"].isDrugRefillPatient(e.patientID);case 10:if(!t.sent){t.next=14;break}t.t1=!0,t.next=15;break;case 14:t.t1=!1;case 15:e.isNoneClientPatient=t.t1;case 16:if(!e.isNoneClientPatient){t.next=25;break}return t.t2=Number,t.next=20,e.patient.getRecentWeight();case 20:return t.t3=t.sent,e.currentWeight=(0,t.t2)(t.t3),t.next=24,ae["a"].get("ART_AUTO_3HP_SELECTION");case 24:e.autoSelect3HP=t.sent;case 25:return t.abrupt("return",!0);case 26:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),validation:function(e){return d["a"].required(e)},computedValue:function(t){return{tag:"consultation",obs:e.buildMedicationOrders(t)}},onValueUpdate:function(t,n,r){var a=e.disablePrescriptions(t,n);return e.on3HPValueUpdate(a,n,r)},options:function(t,n,r,a){return Object(h["isEmpty"])(a)?e.medicationOrderOptions(t):a},condition:function(){return e.isNoneClientPatient},exitsForm:function(){return!0}}].concat(Object(u["a"])(Object(Z["b"])({id:"date_last_received_arvs",helpText:"Last ARV Dispensation",required:!0,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTransferInStatus();case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=!1;case 5:return e.wasTransferredIn=t.t0,t.next=8,e.getDateStartedArt();case 8:return e.dateStartedArt=t.sent,t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(){return e.wasTransferredIn},minDate:function(){return e.dateStartedArt},maxDate:function(){return e.consultation.getDate()},computeValue:function(t){return e.prescription.setDate(t),{tag:"consultation",date:t,obs:e.consultation.buildValueDate("Date drug received from previous facility",t)}},estimation:{allowUnknown:!1}},this.consultation.getDate())),[{id:"previous_arvs_received",helpText:"Last ARV drugs dispensed",type:s["b"].TT_MULTIPLE_SELECT,computedValue:function(e){return e.map((function(e){return e.other}))},validation:function(e){return d["a"].required(e)},options:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Object(h["isEmpty"])(e.customRegimens)){t.next=2;break}return t.abrupt("return",e.customRegimens);case 2:return n=new te["a"](e.patientID,e.providerID),t.next=5,n.getCustomIngridients();case 5:return e.customRegimens=t.sent.map((function(e){return{label:e.name,value:e.drug_id,other:Object(i["a"])({},e)}})),t.abrupt("return",e.customRegimens);case 7:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),config:{showKeyboard:!0},condition:function(){return e.wasTransferredIn}},{id:"drug_interval",helpText:"Duration period for last received ARVs",type:s["b"].TT_NEXT_VISIT_INTERVAL_SELECTION,condition:function(){return e.wasTransferredIn},validation:function(e){return d["a"].required(e)},computedValue:function(e){return e.other.nextAppointment},options:function(){var t=[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}];return t.map((function(t){var n=t.label,r=t.value;e.prescription.setNextVisitInterval(r);var a=e.prescription.calculateDateFromInterval();return{label:n,value:r,other:{label:"Medication run-out date:",value:f["b"].toStandardHisDisplayFormat(a),nextAppointment:a,other:{label:"",value:[]}}}}))}},{id:"arv_quantities",helpText:"Amount of drugs dispensed (From last ART Facility)",type:s["b"].TT_DRUG_TRANSFER_IN,validation:function(t){return e.validateSeries([function(){return d["a"].required(t)},function(){return t.map((function(e){var t;return""===e.value||""===(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.pillsBrought)})).some(Boolean)?["Some Drugs are missing values"]:null}])},computedValue:function(t,n,r){return{tag:"consultation",obs:t.map(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var a,o,u,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=(null===n||void 0===n||null===(a=n.other)||void 0===a||null===(o=a.drug)||void 0===o?void 0:o.drug_id)||0,t.t0=i["a"],t.t1=i["a"],t.t2={},t.next=6,e.consultation.buildObs("Drug received from previous facility",{value_drug:s,value_datetime:(null===r||void 0===r?void 0:r.drug_interval)||null,value_numeric:(null===n||void 0===n?void 0:n.value)||0});case 6:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.next=11,e.consultation.buildObs("Number of tablets brought to clinic",{value_drug:s,value_numeric:(null===n||void 0===n||null===(u=n.other)||void 0===u?void 0:u.pillsBrought)||-1,value_datetime:(null===r||void 0===r||null===(c=r.date_last_received_arvs)||void 0===c?void 0:c.date)||null});case 11:return t.t6=t.sent,t.t7={child:t.t6},t.abrupt("return",(0,t.t0)(t.t4,t.t5,t.t7));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},options:function(e,t,n){return t.previous_arvs_received.map((function(e){var t,r=e["alternative_drug_name"]||e["drug_name"]||e["name"],a=Object(h["find"])(n,{label:r}),i="",o="";a&&(i=null===a||void 0===a?void 0:a.value,o=null===a||void 0===a||null===(t=a.other)||void 0===t?void 0:t.pillsBrought);return{label:r,value:i,other:{drug:e,pillsBrought:o}}}))},condition:function(){return e.wasTransferredIn}},{id:"patient_lab_orders",helpText:"Lab orders",type:s["b"].TT_LAB_ORDERS,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getVlLabData();case 2:return e.labOrders=t.sent,t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),unload:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkVLReminder();case 2:if(n=e.labOrders.filter((function(e){return"No"===e.result_given})),t.t0=n.length,!t.t0){t.next=8;break}return t.next=7,Object(p["a"])("Result(s) Given to Client?");case 7:t.t0=t.sent;case 8:if(!t.t0){t.next=13;break}return r=new I["a"](e.patientID,-1,e.providerID),a=n.reduce((function(e,t){return[].concat(Object(u["a"])(e),Object(u["a"])(t.resultIds.map(function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r.encounterID=t.encounter_id,e.t0=r,e.next=4,r.buildObs("Result Given to Client",{value_coded:"Yes",obs_group_id:n});case 4:return e.t1=e.sent,e.abrupt("return",e.t0.saveObs.call(e.t0,e.t1));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())))}),[]),t.next=13,Promise.all(a);case 13:return t.next=15,e.getVlLabData();case 15:e.labOrders=t.sent;case 16:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),onload:function(t){return e.labOrderFieldContext=t},options:function(){return[{label:"Lab orders",value:"order trail",other:{values:e.labOrders}}]},config:{printOrder:function(t){return new re["a"](e.patientID).printLabOrderLbl(t)},hiddenFooterBtns:["Clear"],footerBtns:[{name:"Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Object(h["isEmpty"])(e.labOrderFieldContext)){t.next=3;break}return t.next=3,e.labOrderFieldContext.launchOrderSelection();case 3:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()}]}},{id:"pregnant_breastfeeding",helpText:"Patient Pregnant or breastfeeding?",init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.patient.isFemale()){t.next=11;break}if(!e.patient.isChildBearing()){t.next=8;break}return t.next=4,e.patient.hasPregnancyObsToday();case 4:return e.hasPregnancyObsToday=t.sent,t.next=7,e.patient.isPregnant();case 7:e.currentlyPregnant=t.sent;case 8:return t.next=10,e.consultation.getTLObs();case 10:e.onPermanentFPMethods=t.sent;case 11:return t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(){return!e.hasPregnancyObsToday&&e.pregnancyEligible()},type:s["b"].TT_MULTIPLE_YES_NO,validation:function(t){return e.validateSeries([function(){return d["a"].required(t)},function(){return d["a"].anyEmpty(t)}])},computedValue:function(t){var n=[];return e.isANCclient()&&n.push(e.consultation.buildValueCoded("Is patient pregnant","Yes")),n=n.concat(t.map((function(t){return e.consultation.buildValueCoded(t.other.concept,t.value)}))),{obs:n,tag:"consultation"}},options:function(t){var n=[];return e.isANCclient()||n.push({label:"Pregnant",value:"",other:{values:e.yesNoOptions(),concept:"Is patient pregnant"}}),n.push({label:"Breastfeeding",value:"",other:{values:e.yesNoOptions(),concept:"Is patient breast feeding"}}),t.pregnant_breastfeeding||n}},{id:"patient_weight_chart",helpText:"Patient weight chart",type:s["b"].TT_WEIGHT_CHART,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.patient.getWeightHistory();case 2:return e.weightTrail=t.sent,e.weightLossPercentageNum=e.patient.getWeightLossPercentageFromTrail(e.weightTrail),e.lostTenPercentBodyWeight=e.weightLossPercentageNum>=10,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),options:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.patient.getBMI();case 2:return n=t.sent,r=e.weightTrail,t.abrupt("return",[{label:"Weight for patient",value:"Weight trail",other:{bmi:n,values:r.map((function(e){return{x:f["b"].toStandardHisDisplayFormat(e.date),y:e.weight}})),age:e.patient.getAge()}}]);case 5:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),config:{hiddenFooterBtns:["Clear"]}},{id:"has_fp_methods",helpText:"",type:s["b"].TT_TEXT_BANNER,condition:function(){return e.onPermanentFPMethods},options:function(){return e.mapStrToOptions(["Patient is on Tubal ligation method"])}},{id:"current_fp_methods",helpText:"What method are you currently on?",type:s["b"].TT_MULTIPLE_SELECT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.patient.isFemale()){t.next=4;break}return t.next=3,e.consultation.patientHitMenopause();case 3:e.patientHitMenopause=t.sent;case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),validation:function(e){return d["a"].required(e)},onValueUpdate:function(t,n){return e.disableFPMethods(t,n)},computedValue:function(t){return{tag:"consultation",obs:t.map((function(t){return e.consultation.buildValueCoded("Family planning method",t.value)}))}},condition:function(t){return e.showCurrentContraceptionMethods(t)},options:function(t,n){return e.getFPMethods([],n)}},{id:"fp_methods",helpText:"What method are you providing today?",type:s["b"].TT_MULTIPLE_SELECT,condition:function(t){return e.showNewContraceptionMethods(t)},validation:function(e){return d["a"].required(e)},onValueUpdate:function(t,n){return e.disableFPMethods(t,n)},computedValue:function(t){return{tag:"consultation",obs:t.map((function(t){return e.consultation.buildValueCoded("Family planning, action to take",t.value)}))}},options:function(t,n){return e.getFPMethods([],n)}},{id:"reason_for_no_fpm",helpText:"Main reason for not using family planning methods",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},condition:function(t){return e.declinedFPM(t)},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueText("Why does the woman not use birth control",t.value)}},options:function(){return e.mapStrToOptions(["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"])}},{id:"specific_reason_for_no_fpm",helpText:"Specific reason for not using family planning methods",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueText("Reason for not using contraceptives",t.value)}},condition:function(t){return e.riskOfUnplannedPregnancy(t)},options:function(){return e.mapStrToOptions(["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"])}},{id:"offer_contraceptives",helpText:"Offer contraceptives",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},condition:function(t){return e.riskOfUnplannedPregnancy(t)},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueCoded("Family planning, action to take",t.value)}},options:function(){return[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]}},{id:"offered_intervention",helpText:"Offered intervention",type:s["b"].TT_MULTIPLE_SELECT,validation:function(e){return d["a"].required(e)},condition:function(e){return"Accepted"===e.offer_contraceptives.value},computedValue:function(t){return{tag:"consultation",obs:t.map((function(t){return e.consultation.buildValueCoded(t.label,t.value)}))}},options:function(t,n){return e.getFPMethods(["NONE"],n)}},{id:"offer_cxca",helpText:"Refer client for CxCa screening",type:s["b"].TT_SELECT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.patient.isFemale()){t.next=18;break}return t.next=3,K["b"].cervicalCancerScreeningEnabled();case 3:if(e.CxCaEnabled=t.sent,!e.CxCaEnabled){t.next=18;break}return t.next=7,K["b"].cervicalCancerScreeningAgeBounds();case 7:return n=t.sent,r=n.start,a=n.end,e.CxCaMaxAge=a,e.CxCaStartAge=r,t.next=14,e.consultation.clientDueForCxCa();case 14:return e.DueForCxCa=t.sent,t.next=17,e.consultation.clientHasHadAHysterectomy();case 17:e.clientHadAHysterectomy=t.sent;case 18:return t.abrupt("return",!0);case 19:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),validation:function(e){return d["a"].required(e)},condition:function(t){return e.canScreenCxCa()&&!e.isPregnant(t)},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueCoded("Offer CxCa",t.value)}},options:function(){return e.yesNoOptions()}},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},condition:function(e){return"No"===e.offer_cxca.value},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueCoded("Reason for NOT offering CxCa",t.value)}},options:function(){return e.getReasonsForNoCxcaOptions()}}],Object(u["a"])(Object(Z["b"])({id:"previous_cxca_test_date",helpText:"Previous CxCa test",required:!0,minDate:function(){return e.patient.getBirthdate()},maxDate:function(){return b["a"].getSessionDate()},condition:function(e){return"Not due for screening"===e.reason_for_no_cxca.value},computeValue:function(t,n){return n?{tag:"consultation",obs:e.consultation.buildValueDateEstimated("CxCa test date",t)}:{tag:"consultation",obs:e.consultation.buildValueDate("CxCa test date",t)}},estimation:{allowUnknown:!0,estimationFieldType:Z["a"].MONTH_ESTIMATE_FIELD}})),[{id:"previous_side_effects",helpText:"Side effects / Contraindications history",type:s["b"].TT_DATA_TABLE,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.consultation.getDrugSideEffects();case 2:return e.sideEffectsHistory=t.sent,t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),config:{columns:function(){return[[$["a"].thTxt("Date"),$["a"].thTxt("Condition"),$["a"].thTxt("Drug induced"),$["a"].thTxt("Drug")]]},rows:function(){return Object.keys(e.sideEffectsHistory).map((function(t){return Object.values(e.sideEffectsHistory[t]).filter((function(e){return!Object(h["isEmpty"])(e.name)})).map((function(e){return[$["a"].tdDate(t),$["a"].td(e.name),$["a"].td(e.drug_induced?"Yes":"No"),$["a"].td(e.drug)]}))})).reduce((function(e,t){return e.concat(t)}),[])}}},{id:"side_effects",helpText:"Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.consultation.getPreviousDrugs();case 2:return e.lastDrugsReceived=t.sent,t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),validation:function(t){return e.validateSeries([function(){return d["a"].required(t)},function(){return d["a"].anyEmpty(t)}])},computedValue:function(t){return{tag:"consultation",obs:t.map(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=i["a"],t.t1=i["a"],t.t2={},t.next=5,e.consultation.buildValueCoded("Malawi ART side effects",n.label);case 5:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.next=10,e.consultation.buildValueCoded(n.label,n.value);case 10:return t.t6=t.sent,t.t7={child:t.t6},t.abrupt("return",(0,t.t0)(t.t4,t.t5,t.t7));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},beforeNext:function(t){return e.buildSideEffectObs(t,"malawiSideEffectReasonObs")},options:function(t,n){return e.getContraindications(n)}},{id:"other_side_effects",helpText:"Other Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,onValue:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkIfWeightLossIsControlled(n);case 2:return t.abrupt("return",!0);case 3:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),condition:function(t){return e.showOtherSideEffects(t)},onConditionFalse:function(){return e.otherSideEffectReasonObs=[]},validation:function(t){return e.validateSeries([function(){return d["a"].required(t)},function(){return d["a"].anyEmpty(t)}])},computedValue:function(t){return{tag:"consultation",obs:t.filter((function(e){return"Other (Specify)"!=e.label})).map(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=i["a"],t.t1=i["a"],t.t2={},t.next=5,e.consultation.buildValueCoded("Other side effect",n.label);case 5:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.next=10,e.consultation.buildValueCoded(n.label,n.value);case 10:return t.t6=t.sent,t.t7={child:t.t6},t.abrupt("return",(0,t.t0)(t.t4,t.t5,t.t7));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},beforeNext:function(t){return e.buildSideEffectObs(t,"otherSideEffectReasonObs")},options:function(t,n){return e.getOtherContraindications(n)}},{id:"other_side_effect_specify",helpText:"Other Contraindications / Side effects (specify)",type:s["b"].TT_NOTE,computedValue:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=i["a"],t.t1=i["a"],t.t2={},t.next=5,e.consultation.buildValueCoded("Other side effect","Other (Specify)");case 5:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.next=10,e.consultation.buildValueText("Other (Specify)",n.value);case 10:return t.t6=t.sent,t.t7={child:t.t6},t.t8=(0,t.t0)(t.t4,t.t5,t.t7),t.abrupt("return",{tag:"consultation",obs:t.t8});case 14:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),condition:function(t){return e.inArray(t.other_side_effects,(function(e){return"Other (Specify)"===e.label&&"Yes"===e.value}))},validation:function(e){return d["a"].required(e)}},{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},computedValue:function(t){e.TBSuspected="Yes"===t.value;var n=[e.consultation.buildValueCoded("TB treatment",t.value)];return e.TBSuspected&&n.push(e.consultation.buildValueCoded("TB Status","Confirmed TB on treatment")),{tag:"consultation",obs:n}},options:function(){return e.yesNoOptions()}},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:s["b"].TT_MULTIPLE_YES_NO,onValue:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkIfWeightLossIsControlled(n);case 2:return t.abrupt("return",!0);case 3:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),validation:function(t){return e.validateSeries([function(){return d["a"].required(t)},function(){return d["a"].anyEmpty(t)}])},condition:function(e){return e.on_tb_treatment.value.match(/no/i)},options:function(t,n){return e.getTBSymptoms(n)},computedValue:function(t){return e.presentedTBSymptoms=e.inArray(t,(function(e){return"Yes"===e.value})),{tag:"consultation",obs:t.map(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=i["a"],t.t1=i["a"],t.t2={},t.next=5,e.consultation.buildValueCoded("Routine TB Screening",n.label);case 5:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.next=10,e.consultation.buildValueCoded(n.label,n.value);case 10:return t.t6=t.sent,t.t7={child:t.t6},t.abrupt("return",(0,t.t0)(t.t4,t.t5,t.t7));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},{id:"tb_status",helpText:"TB Status",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},condition:function(t){return e.hasTBSymptoms(t)},onConditionFalse:function(){return e.TBSuspected=!1},defaultValue:function(){return"TB Suspected"},computedValue:function(t){return e.TBSuspected="TB Suspected"===t.value,{tag:"consultation",obs:e.consultation.buildValueCoded("TB Status",t.value)}},beforeNext:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("TB Suspected"!==n.value){t.next=5;break}return t.next=3,Object(V["a"])("Lab Order","The patient is a TB suspect. Do you want to take lab orders?","",[{name:"Order now",slot:"start",color:"success"},{name:"NOT now",slot:"end",color:"danger"}]);case 3:r=t.sent,"Order now"===r&&e.labOrderFieldContext.launchOrderSelection(["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"]);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),options:function(){return e.mapStrToOptions(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"])}},{id:"routine_tb_therapy",helpText:"TB preventive therapy (TPT) history",type:s["b"].TT_SELECT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.consultation.hasTreatmentHistoryObs();case 2:if(e.hasTbHistoryObs=t.sent,!e.hasTbHistoryObs){t.next=7;break}return t.next=6,e.consultation.patientCompleted3HP();case 6:e.completed3HP=t.sent;case 7:if(e.completed3HP){t.next=11;break}return t.next=10,e.consultation.hasCompleteTptDispensations();case 10:e.completed3HP=t.sent;case 11:return t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),validation:function(e){return d["a"].required(e)},condition:function(){return!e.hasTbHistoryObs},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueText("Previous TB treatment history",t.value)}},options:function(){return e.mapStrToOptions(["Currently on IPT","Currently on 3HP","Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP or IPT in the past","Never taken IPT or 3HP"])}},{id:"allergic_to_sulphur",helpText:"Allergic to Cotrimoxazole",type:s["b"].TT_SELECT,validation:function(e){return d["a"].required(e)},computedValue:function(t){return e.allergicToSulphur=t.value.match(/unknown/i)?null:!!t.value.match(/yes/i),{tag:"consultation",obs:function(){return e.consultation.buildValueCoded("Allergic to sulphur",null===e.allergicToSulphur?t.value:e.allergicToSulphur?"Yes":"No")}}},options:function(){return e.yesNoUnknownOptions()}}],Object(u["a"])(this.getAdherenceFields(!0)),[{id:"refer_to_clinician",helpText:"Refer to clinician",type:s["b"].TT_SELECT,condition:function(){return g["a"].isNurse()},validation:function(e){return d["a"].required(e)},computedValue:function(t){return{tag:"consultation",obs:e.consultation.buildValueCoded("Refer to clinician",t.value)}},options:function(){return e.yesNoOptions()}},{id:"medication_to_prescribe",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isNoneClientPatient){t.next=9;break}return t.t0=Number,t.next=4,e.patient.getRecentWeight();case 4:return t.t1=t.sent,e.currentWeight=(0,t.t0)(t.t1),t.next=8,ae["a"].get("ART_AUTO_3HP_SELECTION");case 8:e.autoSelect3HP=t.sent;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(e){return!e.refer_to_clinician||"".concat(e.refer_to_clinician.value).match(/no/i)},validation:function(e){return d["a"].required(e)},computedValue:function(t){return{tag:"consultation",obs:e.buildMedicationOrders(t)}},onValueUpdate:function(t,n,r){var a=e.disablePrescriptions(t,n);return e.on3HPValueUpdate(a,n,r)},options:function(t,n,r,a){return e.medicationOrderOptions(t,a)},config:{footerBtns:[{name:"Update allergic to CPT",onClickComponentEvents:{refreshOptions:function(t,n,r){return e.allergicToSulphur="Allergic"===t.btnOutput,e.medicationOrderOptions(r,n)}},onClick:function(){return Object(V["a"])("Allergic to Cotrimoxazole update","Is the patient allergic to cotrimoxazole.","",[{name:"Allergic",slot:"start",color:"success"},{name:"NOT Allergic",slot:"end"}])}}]}}])}}});const oe=D()(ie,[["render",a]]);t["default"]=oe},d42f:function(e,t,n){"use strict";n("1c3d")},d58f:function(e,t,n){var r=n("1c0b"),a=n("7b0b"),i=n("44ad"),o=n("50c4"),u=function(e){return function(t,n,u,c){r(n);var s=a(t),l=i(s),d=o(s.length),p=e?d-1:0,f=e?-1:1;if(u<2)while(1){if(p in l){c=l[p],p+=f;break}if(p+=f,e?p<0:d<=p)throw TypeError("Reduce of empty array with no initial value")}for(;e?p>=0:d>p;p+=f)p in l&&(c=n(c,l[p],p,s));return c}};e.exports={left:u(!1),right:u(!0)}},dac2:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r,a=n("2909"),i=n("1da1"),o=n("d4ec"),u=n("bee2"),c=n("262e"),s=n("2caf"),l=(n("96cf"),n("d81d"),n("caad"),n("2532"),n("d3b7"),n("99af"),n("159b"),n("07ac"),n("4de4"),n("b0c0"),n("3ca3"),n("ddb0"),n("25f0"),n("71c3")),d=n("9283"),p=n("1c74"),f=function(e){Object(c["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(o["a"])(this,n),t.call(this)}return Object(u["a"])(n,null,[{key:"getAllArvRegimens",value:function(){return this.getJson("programs/".concat(this.getProgramID(),"/all_arv_regimens"))}},{key:"getRegimens",value:function(e){return this.getJson("programs/".concat(this.getProgramID(),"/regimens"),{patient_id:e})}},{key:"getCustomIngridients",value:function(){return this.getJson("programs/".concat(this.getProgramID(),"/custom_regimen_ingredients"))}},{key:"getCurrentRegimen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSessionDate();return this.getJson("programs/".concat(this.getProgramID(),"/").concat(e),{date:t})}}]),n}(p["e"]),h=n("2ef0"),b=n("cc6f");(function(e){e["CONTRAINDICATION"]="contraindication",e["SIDE_EFFECT"]="side_effect"})(r||(r={}));var g=function(e){Object(c["a"])(n,e);var t=Object(s["a"])(n);function n(e,r){var a;return Object(o["a"])(this,n),a=t.call(this,e,25,r),a.nextVisitInterval=0,a.fastTrack=!1,a.regimenExtras=[],a.fastTrackMedications=[],a.hangingPills=[],a.medicationOrders=[],a.treatmentState="",a.contraindications={},a.sideEffects={},a.tptPrescriptionCount=0,a.lastSideEffectDate="",a}return Object(u["a"])(n,[{key:"setNextVisitInterval",value:function(e){this.nextVisitInterval=e}},{key:"getHangingPills",value:function(){return this.hangingPills}},{key:"getMedicationOrders",value:function(){return this.medicationOrders.map((function(e){return b["a"].getCachedConceptName(e)}))}},{key:"getTptPrescriptionCount",value:function(){return this.tptPrescriptionCount}},{key:"getLastSideEffectDate",value:function(){return this.lastSideEffectDate}},{key:"getContraindications",value:function(){return this.contraindications}},{key:"getSideEffects",value:function(){return this.sideEffects}},{key:"getRegimenExtras",value:function(){return this.regimenExtras}},{key:"getPatientRegimens",value:function(){return f.getRegimens(this.patientID)}},{key:"getCustomIngridients",value:function(){return f.getCustomIngridients()}},{key:"getFastTrackMedications",value:function(){return this.fastTrackMedications}},{key:"getTreatmentState",value:function(){return this.treatmentState}},{key:"isFastTrack",value:function(){return this.fastTrack}},{key:"medicationOrdersAvailable",value:function(){return!Object(h["isEmpty"])(this.medicationOrders)}},{key:"shouldPrescribeArvs",value:function(){var e=b["a"].getCachedConceptID("Antiretroviral drugs");return this.medicationOrders.includes(e)}},{key:"shouldPrescribeExtras",value:function(){var e=this,t=b["a"].getConceptsByCategory("art_extra_medication_order"),n=t.map((function(t){return e.medicationOrders.includes(t.concept_id)}));return n.some(Boolean)}},{key:"getRegimenStarterpack",value:function(e,t){var n={weight:t,regimen:e};return b["a"].getJson("programs/".concat(b["a"].getProgramID(),"/regimen_starter_packs"),n)}},{key:"getLvpDrugsByType",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",b["a"].getJson("programs/".concat(b["a"].getProgramID(),"/regimens/").concat(n),{patient_id:this.patientID,lpv_drug_type:t}));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"loadContraindications",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getConceptID("Contraindications");case 2:return t=e.sent,e.next=5,b["a"].getObs({concept_id:t,person_id:this.patientID});case 5:n=e.sent,n.forEach((function(e){var t=d["b"].toStandardHisFormat(e.obs_datetime);r.contraindications[t]||(r.contraindications[t]=[]);var n=b["a"].getCachedConceptName(e.value_coded);r.contraindications[t].push(n)}));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadDrugInduced",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getConceptID("Drug induced");case 2:return t=e.sent,e.next=5,b["a"].getObs({concept_id:t,person_id:this.patientID});case 5:if(n=e.sent,n){e.next=8;break}return e.abrupt("return");case 8:n.forEach((function(e){var t=d["b"].toStandardHisFormat(e.obs_datetime);if(r.lastSideEffectDate||(r.lastSideEffectDate=t),e.value_drug&&e.value_coded){r.sideEffects[t]||(r.sideEffects[t]={}),r.sideEffects[t][e.value_drug]||(r.sideEffects[t][e.value_drug]=[]);var n=b["a"].getCachedConceptName(e.value_coded);r.sideEffects[t][e.value_drug].push(n)}}));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTptPrescriptionCount",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getJson("tpt_prescription_count",{patient_id:this.patientID,date:this.date});case 2:t=e.sent,t&&(n=t.count+1,this.tptPrescriptionCount=n>3?3:n);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFastTrackStatus",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getFirstValueCoded(this.patientID,"Fast track");case 2:return t=e.sent,e.next=5,b["a"].getConceptID("yes");case 5:n=e.sent,t&&(this.fastTrack=t===n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadRegimenExtras",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.date,e.next=3,f.getJson("programs/".concat(f.getProgramID(),"/patients/").concat(this.patientID,"/dosages"),{date:t});case 3:n=e.sent,n&&(this.regimenExtras=Object.values(n));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadMedicationOrders",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getConceptID("Medication orders");case 2:return t=e.sent,e.next=5,b["a"].getObs({concept_id:t,date:this.date,person_id:this.patientID,page_size:5});case 5:n=e.sent,this.medicationOrders=n.map((function(e){return e.value_coded}));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadHangingPills",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getAll(this.patientID,"Pills brought");case 2:t=e.sent,t&&(this.hangingPills=t.filter((function(e){return e.value_numeric>=1&&e.order})).map((function(e){return e.order.drug_order.drug_inventory_id})));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFastTrackMedications",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["a"].getLastDrugsReceived(this.patientID);case 2:return t=e.sent,n=t.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.drug,e.next=3,l["a"].getDrugDosages(r.patientID,n.drug_id);case 3:return a=e.sent,e.abrupt("return",{drug_id:n.drug_id,drug_name:n.name,units:n.units,am:a.am,noon:a.noon,pm:a.pm,frequency:t.frequency});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=6,Promise.all(n);case 6:this.fastTrackMedications=e.sent;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTreatmentState",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={date:this.date},e.next=3,b["a"].getJson("programs/".concat(b["a"].getProgramID(),"/patients/").concat(this.patientID,"/status"),t);case 3:n=e.sent,n&&(this.treatmentState=n["status"]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"findAndGroupDrugSideEffects",value:function(e){var t={};for(var n in this.sideEffects){var r=this.sideEffects[n];for(var i in r)e.includes(parseInt(i))&&(t[n]||(t[n]=[]),t[n]=[].concat(Object(a["a"])(t[n]),Object(a["a"])(r[i])))}return t}},{key:"calculatePillsPerDay",value:function(e,t,n){return parseFloat(e.toString())+t+n}},{key:"estimatePackSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e*this.nextVisitInterval/t,r=Math.round(n);return r<=0&&(r+=1),r}},{key:"calculateDosage",value:function(e,t){var n=0;return 0===t&&(n=e),0==e&&(n=t),e>0&&t>0&&(n=(e+t)/2),n}},{key:"calculateEquivalentDosage",value:function(e,t){return e+t}},{key:"calculateDateFromInterval",value:function(){var e=new Date(this.date);return e.setDate(e.getDate()+this.nextVisitInterval),d["b"].toStandardHisFormat(e)}},{key:"getDrugPackSize",value:function(e){if(e.pack_size)return e.pack_size;try{return e.barcodes[0].tabs}catch(t){return 30}}},{key:"getInstructions",value:function(e,t,n,r){return"".concat(e," :- Morning: ").concat(t," ").concat(r,", Evening: ").concat(n," ").concat(r)}},{key:"toOrderObj",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return{drug_inventory_id:e,equivalent_daily_dose:this.calculateEquivalentDosage(r,a),start_date:this.date,auto_expire_date:this.calculateDateFromInterval(),units:n,instructions:this.getInstructions(t,r,a,n),dose:this.calculateDosage(r,a),frequency:i}}},{key:"getReasonForRegimenSwitch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b["a"].getFirstValueText(this.patientID,"Reason for ARV switch");case 2:return t=e.sent,e.abrupt("return",t||"N/A");case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createDrugOrder",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",l["a"].create({encounter_id:this.encounterID,drug_orders:t}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createHangingPillsObs",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveValueTextObs("appointment type",t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createRegimenSwitchObs",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveValueTextObs("Reason for ARV switch",t));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(b["a"])},e96c:function(e,t,n){"use strict";n("113a")},fe96:function(e,t,n){"use strict";var r=n("5530"),a=n("2909"),i=n("1da1"),o=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("99af"),n("159b"),n("b0c0"),n("ac1f"),n("466d"),n("d81d"),n("7a23")),u=n("d95e"),c=n("b5e4"),s=n("d4ec"),l=n("bee2"),d=n("262e"),p=n("2caf"),f=(n("4de4"),n("caad"),n("2532"),n("25f0"),n("cc6f")),h=n("9283"),b=n("2ef0"),g=n("32b3"),m=n("5a0c"),v=n.n(m),O=function(e){Object(d["a"])(n,e);var t=Object(p["a"])(n);function n(e,r){var a;return Object(s["a"])(this,n),a=t.call(this,e,68,r),a.lastDrugs=[],a.lastReceiptDate="",a}return Object(l["a"])(n,[{key:"loadPreviousDrugs",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new Date(this.date),t.setDate(t.getDate()-1),n=function(e){return h["b"].toStandardHisFormat(e)},e.next=5,f["a"].getJson("patients/".concat(this.patientID,"/drugs_received"),{date:n(t)});case 5:r=e.sent,r&&(this.lastReceiptDate=r.reduce((function(e,t){return!e||new Date(n(t.order.start_date))>new Date(e)?n(t.order.start_date):e}),null),a=g["a"].htnDrugReferences().map((function(e){return e.drug_id})),this.lastDrugs=r.filter((function(e){return!a.includes(e.drug["drug_id"])&&n(e.order.start_date)===i.lastReceiptDate})));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getReceiptDate",value:function(){return this.lastReceiptDate}},{key:"getLastDrugs",value:function(){return this.lastDrugs}},{key:"receivedDrugsBefore",value:function(){return!Object(b["isEmpty"])(this.lastDrugs)}},{key:"buildPillCountObs",value:function(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}},{key:"buildAdherenceObs",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].getConceptID("Drug adherence",!0);case 2:return a=e.sent,e.abrupt("return",{concept_id:a,value_numeric:r,value_drug:n,value_modifier:"%",order_id:t,person_id:this.patientID,obs_datetime:f["a"].getSessionDate()});case 4:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"isAdherenceGood",value:function(e){return e>=95&&e<=105}},{key:"calculateAdherence",value:function(e,t,n){return Math.round(100*(e-t)/(e-n))}},{key:"calculateExpected",value:function(e,t,n,r){var a="QW"===r?"week":"day",i=this.calcTimeElapsed(n,a);return e-i*parseFloat(t.toString())}},{key:"calcTimeElapsed",value:function(e,t){return v()(this.date).diff(e,t)}},{key:"calculateUnaccountedOrMissed",value:function(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?-1*n+" missed":n+" unacc"}}]),n}(f["a"]),y=n("7365"),x=n("2706"),T=Object(o["defineComponent"])({mixins:[y["a"]],data:function(){return{adherence:{},drugObs:[],askReasonForPoorAdherence:!1,calculationAgreementObs:[]}},methods:{saveAdherence:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.adherence.createEncounter();case 2:return t.next=4,Promise.all([].concat(Object(a["a"])(e.drugObs),Object(a["a"])(e.calculationAgreementObs)));case 4:return n=t.sent,t.next=7,e.adherence.saveObservationList(n);case 7:if(r=t.sent,r){t.next=10;break}return t.abrupt("return",Object(c["e"])("Unable to save patient observations"));case 10:case"end":return t.stop()}}),t)})))()},buildAdherenceReport:function(e){var t=this,n=this.adherence.getReceiptDate(),r=this.adherence.calcTimeElapsed(n,"day"),a=" Last visit: ".concat(h["b"].toStandardHisDisplayFormat(n)," \n                (").concat(r," Days Elapsed)"),i=[{indexes:[0,3,6],class:"adherence-col-bg"}],o=[],u=[a],c=[["Prescription"],["Tabs given"],["Tabs per"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];return e.forEach((function(e,n){var r=t.formatFrequency(e.frequency),a=t.calcPillsExpected(e),i=t.adherence.calculateAdherence(e.quantity,e.pillsBrought,a),s=t.adherence.isAdherenceGood(i)?"Good adherence":"Explore problem",l=t.adherence.calculateUnaccountedOrMissed(a,e.pillsBrought);u.push(e.drug.name),c[0].push(""),c[1].push(e.quantity),c[2].push("".concat(e.equivalent_daily_dose," <b>").concat(r,"</b>")),c[3].push(""),c[4].push(a<0?0:a),c[5].push(e.pillsBrought),c[6].push(""),c[7].push(l),c[8].push("".concat(i,"%")),c[9].push(s),o.push({index:n+1,row:9,class:s.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})})),[{label:"Selected Medication",value:"Table",other:{columns:u,rows:c,rowColors:i,cellColors:o}}]},formatFrequency:function(e){return"".concat(e).match(/qod/i)?"QOD":"".concat(e).match(/weekly/i)?"QW":e},calcPillsExpected:function(e){return this.adherence.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,this.formatFrequency(e.frequency))},getAdherenceFields:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return[{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:u["b"].TT_ADHERENCE_INPUT,init:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.adherence=new O(e.patientID,e.providerID),t.next=3,e.adherence.loadPreviousDrugs();case 3:return t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(){return!t||e.adherence.receivedDrugsBefore()},validation:function(e){if(x["a"].required(e))return["No drugs available"];var t=e.map((function(e){return""===e.value}));return t.some(Boolean)?["Some values are missing"]:null},unload:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.drugObs=[],n.forEach(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){var a,i,o,u,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=n.other,i=a.drug,o=a.order,u=Object(r["a"])(Object(r["a"])({},n.other),{},{pillsBrought:n.value}),c=e.adherence.calculateAdherence(u.quantity,u.pillsBrought,e.calcPillsExpected(u)),e.drugObs.push(e.adherence.buildAdherenceObs(o.order_id,i.drug_id,c)),e.drugObs.push(e.adherence.buildPillCountObs(o.order_id,n.value)),e.askReasonForPoorAdherence||(e.askReasonForPoorAdherence=!e.adherence.isAdherenceGood(u));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),options:function(t){return Object(b["isEmpty"])(t.pills_brought)?e.adherence.getLastDrugs().map((function(e){return{label:e.drug.name,value:"",other:Object(r["a"])({},e)}})):t.pills_brought}},{id:"adherence_report",helpText:"ART adherence",type:u["b"].TT_TABLE_VIEWER,condition:function(){return!t||e.adherence.receivedDrugsBefore()},options:function(t){return e.buildAdherenceReport(t.pills_brought.map((function(e){return Object(r["a"])(Object(r["a"])({},e.other),{},{pillsBrought:e.value})})))},config:{hiddenFooterBtns:["Clear"]}},{id:"agree_with_calculation",helpText:"Agree with adherence calculation",type:u["b"].TT_SELECT,condition:function(){return e.askReasonForPoorAdherence},validation:function(e){return x["a"].required(e)},unload:function(t){var n=t.value;e.calculationAgreementObs=[e.adherence.buildValueCoded("Reason for poor treatment adherence",n)]},options:function(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}}]}}});const _=T;t["a"]=_}}]);
//# sourceMappingURL=chunk-07594c63.9a80bb2c.js.map