(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f9749ab"],{"113a":function(e,t,a){},"1c3d":function(e,t,a){},3800:function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"l",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"b",(function(){return s})),a.d(t,"k",(function(){return r})),a.d(t,"i",(function(){return l})),a.d(t,"g",(function(){return c})),a.d(t,"a",(function(){return u})),a.d(t,"j",(function(){return d})),a.d(t,"c",(function(){return h})),a.d(t,"h",(function(){return p})),a.d(t,"f",(function(){return b}));var n=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["","Done",""]],i=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["Clear","%","/"]],o=[["1","2","3"],["4","5","6"],["7","8","9"],["Del.","0","Clear"]],s=[["1","2","3","<"],["4","5","6",">"],["7","8","9","="],["","0",""]],r=[["1","2","3","+","-","/","*"],["4","5","6","%","=","<",">","Qwerty"],["7","8","9",".",","],["","0",""]],l=[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],c=[["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31"]],u=[["a","b","c","d","e","f","g","h","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],d=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","'"],["z","x","c","v","b","n","m",",",".","A-Z"]],h=[["1","2","3","4","5","6","7","8","9","0"],["a","b","c","d","e","f","g","h","-","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],p=[["1","2","3","4","5","6","7","8","9","0","Del"],["q","w","e","r","t","y","u","i","o","p","Clear"],["a","s","d","f","g","h","j","k","l",".","Caps"],["z","x","c","v","b","n","m","<",">","/","Enter"]],b=[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","Del."],["z","x","c","v","b","n","m","Caps","Login"]]},"3b8c":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a("cc6f"),i=a("7957"),o=a("5a0c"),s=a.n(o),r=a("2ef0");class l extends n["a"]{constructor(e,t){super(e,53,t)}getFamilyPlanningMethods(){return["ORAL CONTRACEPTIVE PILLS","DEPO-PROVERA","INTRAUTERINE CONTRACEPTION","CONTRACEPTIVE IMPLANT","MALE CONDOMS","FEMALE CONDOMS","TUBAL LIGATION","NONE"]}async getTptTreatmentStatus(){return n["a"].getJson(`/patients/${this.patientID}/tpt_status`)}async patientHitMenopause(){const e=await i["a"].getFirstObs(this.patientID,"Why does the woman not use birth control");return!(!e||"string"!==typeof(null===e||void 0===e?void 0:e.value_text))&&(!!e.value_text.match(/menopause/i)&&n["a"].obsInValidPeriod(e))}async hasTreatmentHistoryObs(){const e=await i["a"].getFirstObs(this.patientID,"Previous TB treatment history");return e&&n["a"].obsInValidPeriod(e)}getDrugSideEffects(){return n["a"].getJson(`programs/${n["a"].getProgramID()}/patients/${this.patientID}/medication_side_effects`,{date:this.date})}getClient(){return n["a"].getFirstValueCoded(this.patientID,"Patient present")}async clientDueForCxCa(){const e=await n["a"].getJson("last_cxca_screening_details",{id:this.patientID,date:this.date});if(!Object(r["isEmpty"])(e)){const t=e["date_screened"],a=s()(this.date).diff(t,"years");return a>=1}return!0}async clientHasHadAHysterectomy(){const e=await n["a"].getFirstValueCoded(this.patientID,"Reason for NOT offering CxCa");if("Hysterectomy"===e)return!0;const t=await n["a"].getFirstValueText(this.patientID,"Treatment");return"Hysterectomy"===t}async getTLObs(){const e=e=>e&&"Tubal ligation"===e.value_coded&&n["a"].obsInValidPeriod(e),t=await n["a"].getFirstObs(this.patientID,"Family planning");if(e(t))return e(t);{const t=await n["a"].getFirstObs(this.patientID,"Method of family planning");return e(t)}}async getPreviousDrugs(){const e=await n["a"].getJson(`patients/${this.patientID}/drugs_received`);if(!e)return;const t={};return e.forEach(e=>{t[e.drug_inventory_id]=e}),t}familyPlanningMethods(e,t){const a={"ORAL CONTRACEPTIVE PILLS":{"DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"DEPO-PROVERA":{"ORAL CONTRACEPTIVE PILLS":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"INTRAUTERINE CONTRACEPTION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"CONTRACEPTIVE IMPLANT":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"MALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"FEMALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","MALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"RYTHM METHOD":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","CONTRACEPTIVE IMPLANT":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"TUBAL LIGATION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N",VASECTOMY:"N"},VASECTOMY:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N"},NONE:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N","TUBAL LIGATION":"N"}},n=a[e];return t.map(e=>"N"===n[e.label]?{label:e.label,value:e.value,isChecked:!1,disabled:!0}:{label:e.label,value:e.value,isChecked:e.isChecked,disabled:!1})}}},"5f2c":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a("cc6f"),i=a("71c3"),o=(a("13d5"),a("1c74"));class s extends o["e"]{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(t&&t.length>0)return t.reduce((e,t)=>e+t.current_quantity,0)}}var r=a("d1ca");const l={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[30,60,90],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,12]};class c extends n["a"]{constructor(e,t){super(e,54,t),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(e){this.useDrugManagement=e}async loadDrugManagementEnabled(){this.useDrugManagement=await r["b"].drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(e,t,a){const n=[];for(let i=0;i<a;i++)n.push({drug_order_id:e,date:this.date,quantity:t/a});return n}saveDispensations(e){return n["a"].postJson("/dispensations",{dispensations:e,program_id:n["a"].getProgramID()})}async voidOrder(e){return n["a"].void("/dispensations/"+e,{})}async loadDrugHistory(){try{const e=await i["a"].getDrugOrderHistory(this.patientID);e&&(this.drugHistory=e)}catch(e){console.warn(e)}}async loadCurrentDrugOrder(){const e=await i["a"].getDrugOrders(this.patientID);if(e){if(this.useDrugManagement){const t=e.map(async e=>(e["available_stock"]=await s.fetchAvailableDrugStock(e.drug.drug_id),e));return void(this.currentDrugOrder=await Promise.all(t))}this.currentDrugOrder=e}}getDrugPackSizes(e){return e in l?l[e]:[30,60,90]}calcCompletePack(e,t){const a=e.barcodes.sort((e,t)=>e.tabs-t.tabs);if(0==a.length||0==t)return t;for(const i in a){const{tabs:e}=a[i];if(parseInt(e)>=t)return e}const n=parseInt(a[a.length-1].tabs);return n}}},"6be2":function(e,t,a){"use strict";a.d(t,"d",(function(){return o})),a.d(t,"g",(function(){return s})),a.d(t,"f",(function(){return r})),a.d(t,"e",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return u})),a.d(t,"h",(function(){return h})),a.d(t,"a",(function(){return p}));var n=a("3800"),i=[n["k"],[["","Delete"]]],o=[n["i"],[["Delete"]]],s=[n["i"],[["Delete","Unknown"]]],r=[n["i"],[["N/A"],["Delete","Unknown"]]],l=[n["i"],[["Delete"]]],c=[n["i"],[["Unknown","Delete"],["Qwerty","A-Z"]]],u=[n["g"],[["Unknown"]]],d=[n["a"],[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],h=[n["j"],[["","Delete"],["?123","0-9"],["Space","Unknown"]]],p=[{btn:"0-9",keyboard:c},{btn:"?123",keyboard:i},{btn:"A-Z",keyboard:d},{btn:"Qwerty",keyboard:h}]},"6c3f":function(e,t,a){"use strict";a.r(t);var n=a("7a23");function i(e,t,a,i,o,s){const r=Object(n["resolveComponent"])("his-standard-form");return Object(n["openBlock"])(),Object(n["createBlock"])(r,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}a("13d5");var o=a("d95e"),s=a("7920"),r=a("2706"),l=a("b5e4"),c=a("9283"),u=a("2ef0"),d=a("3b8c"),h=a("c1e4"),p=a("9b7c"),b=a("8158"),m=a("fe96"),g=a("8a30");const T=Object(n["withScopeId"])("data-v-10a26cd2");Object(n["pushScopeId"])("data-v-10a26cd2");const f=Object(n["createTextVNode"])("VL milestone has been reached"),O=Object(n["createTextVNode"])(" Order VL"),v=Object(n["createTextVNode"])(" Wait till next milestone"),y=Object(n["createTextVNode"])(" Remind me later ");Object(n["popScopeId"])();const C=T((function(e,t,a,i,o,s){const r=Object(n["resolveComponent"])("ion-title"),l=Object(n["resolveComponent"])("ion-toolbar"),c=Object(n["resolveComponent"])("ion-header"),u=Object(n["resolveComponent"])("ion-content"),d=Object(n["resolveComponent"])("ion-button"),h=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(c,null,{default:T(()=>[Object(n["createVNode"])(l,null,{default:T(()=>[Object(n["createVNode"])(r,null,{default:T(()=>[f]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(u,{style:{overflowY:"hidden",background:"grey"}},{default:T(()=>[Object(n["createVNode"])("p",null,"ART start date : "+Object(n["toDisplayString"])(e.artStartDate),1),Object(n["createVNode"])("p",null,"Months on ART: "+Object(n["toDisplayString"])(e.monthsOnART),1),Object(n["createVNode"])("p",null,"Last VL order date "+Object(n["toDisplayString"])(e.lastOrder),1),Object(n["createVNode"])("p",null,"Current regimen / start date: "+Object(n["toDisplayString"])(e.currentRegimen)+" - "+Object(n["toDisplayString"])(e.regimenStartDate),1)]),_:1}),Object(n["createVNode"])(h,null,{default:T(()=>[Object(n["createVNode"])(l,null,{default:T(()=>[Object(n["createVNode"])(d,{slot:"end",color:"success",size:"large",onClick:t[1]||(t[1]=t=>e.closeModal("order"))},{default:T(()=>[O]),_:1}),Object(n["createVNode"])(d,{slot:"end",size:"large",onClick:t[2]||(t[2]=t=>e.closeModal("wait"))},{default:T(()=>[v]),_:1}),Object(n["createVNode"])(d,{slot:"start",color:"danger",size:"large",onClick:t[3]||(t[3]=t=>e.closeModal("later"))},{default:T(()=>[y]),_:1})]),_:1})]),_:1})],64)}));var N=Object(n["defineComponent"])({name:"Modal",props:{VLData:{type:Object,required:!0}},async created(){this.artStartDate=c["b"].toStandardHisDisplayFormat(this.VLData.earliest_start_date),this.monthsOnART=this.VLData.period_on_art,this.lastOrder=this.VLData.last_order_date?c["b"].toStandardHisDisplayFormat(this.VLData.last_order_date):"N/A",this.currentRegimen=this.VLData.current_regimen.name?this.VLData.current_regimen.name:"Other",this.regimenStartDate=c["b"].toStandardHisDisplayFormat(this.VLData.current_regimen.date_started)},methods:{async closeModal(e){await g["X"].dismiss(e)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:g["q"],IonToolbar:g["Q"],IonTitle:g["P"],IonContent:g["n"],IonFooter:g["o"],IonButton:g["d"]}}),E=(a("d42f"),a("6b0d")),_=a.n(E);const I=_()(N,[["render",C],["__scopeId","data-v-10a26cd2"]]);var D=I,P=a("ad60"),A=a("cc6f");class S extends A["a"]{constructor(e,t){super(e,13,t)}async buildDefferedOrder(e){const t=await A["a"].getConceptID("HIV viral load"),a=await A["a"].getConceptID("Delayed milestones");return[{concept_id:t,value_text:"Wait till next milestone",value_coded:a,value_numeric:e}]}}var w=a("7f35");const V=Object(n["withScopeId"])("data-v-546674a2");Object(n["pushScopeId"])("data-v-546674a2");const R=Object(n["createTextVNode"])("Side effects suspected causes"),L={style:{}},x=Object(n["createVNode"])("div",{class:"side-title"}," Select reason ",-1),M=Object(n["createVNode"])("p",null,"Current Medication",-1),k=Object(n["createVNode"])("p",null,"Previous Medication",-1),j=Object(n["createTextVNode"])("Other, not drug related"),H=Object(n["createTextVNode"])("Drug side effect"),F=Object(n["createVNode"])("p",null,null,-1),B=Object(n["createTextVNode"])(" Close "),Y=Object(n["createTextVNode"])(" Save ");Object(n["popScopeId"])();const U=V((function(e,t,a,i,o,s){const r=Object(n["resolveComponent"])("ion-title"),l=Object(n["resolveComponent"])("ion-toolbar"),c=Object(n["resolveComponent"])("ion-header"),u=Object(n["resolveComponent"])("ion-label"),d=Object(n["resolveComponent"])("ion-item"),h=Object(n["resolveComponent"])("ion-list"),p=Object(n["resolveComponent"])("ion-col"),b=Object(n["resolveComponent"])("ion-radio"),m=Object(n["resolveComponent"])("ion-radio-group"),g=Object(n["resolveComponent"])("ion-row"),T=Object(n["resolveComponent"])("ion-grid"),f=Object(n["resolveComponent"])("ion-content"),O=Object(n["resolveComponent"])("ion-button"),v=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(c,null,{default:V(()=>[Object(n["createVNode"])(l,null,{default:V(()=>[Object(n["createVNode"])(r,null,{default:V(()=>[R]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(f,{style:{overflowY:"hidden",background:"grey"}},{default:V(()=>[Object(n["createVNode"])(T,null,{default:V(()=>[Object(n["createVNode"])(g,null,{default:V(()=>[Object(n["createVNode"])(p,{size:"4"},{default:V(()=>[Object(n["createVNode"])(h,{style:{overflowY:"auto",height:"78vh"}},{default:V(()=>[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e.sides,(t,a)=>(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:t,onClick:t=>e.selectSideEffect(a),detail:!0,style:e.activeIndex===a?"color: green":"color: black"},{default:V(()=>[Object(n["createVNode"])(u,null,{default:V(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.label),1)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1})]),_:1}),Object(n["createVNode"])(p,{style:{overflowY:"auto",height:"78vh"}},{default:V(()=>[Object(n["createVNode"])("div",L,[Object(n["createVNode"])(h,null,{default:V(()=>[null!==e.activeIndex?(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,modelValue:e.sides[e.activeIndex]["reason"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.sides[e.activeIndex]["reason"]=t)},{default:V(()=>[x,M,(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e.drugs,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:t},{default:V(()=>[Object(n["createVNode"])(u,null,{default:V(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.drug.name),1)]),_:2},1024),Object(n["createVNode"])(b,{slot:"start",value:e.drug_inventory_id},null,8,["value"])]),_:2},1024))),128)),k,Object(n["createVNode"])(d,null,{default:V(()=>[Object(n["createVNode"])(u,null,{default:V(()=>[j]),_:1}),Object(n["createVNode"])(b,{slot:"start",value:"other"})]),_:1}),Object(n["createVNode"])(d,null,{default:V(()=>[Object(n["createVNode"])(u,null,{default:V(()=>[H]),_:1}),Object(n["createVNode"])(b,{slot:"start",value:"drug"})]),_:1})]),_:1},8,["modelValue"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),F]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,null,{default:V(()=>[Object(n["createVNode"])(l,null,{default:V(()=>[Object(n["createVNode"])(O,{onClick:e.closeModal,slot:"end",color:"danger"},{default:V(()=>[B]),_:1},8,["onClick"]),Object(n["createVNode"])(O,{onClick:e.postSideEffects,slot:"end",disabled:!e.allSelected},{default:V(()=>[Y]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})],64)}));var q=Object(n["defineComponent"])({name:"Modal",props:{sideEffects:{type:Object,required:!0},drugs:{type:Array,default:[]}},methods:{closeModal(){g["X"].dismiss()},async postSideEffects(){await g["X"].dismiss(this.sides)},selectSideEffect(e){this.activeIndex=e}},computed:{allSelected(){return this.sides.filter(e=>e["reason"]).length===this.sides.length}},mounted(){this.sides=this.sideEffects},data(){return{content:"Content",extendedLabsEnabled:!1,appActivities:[],sides:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}},components:{IonButton:g["d"],IonContent:g["n"],IonHeader:g["q"],IonTitle:g["P"],IonToolbar:g["Q"],IonLabel:g["x"],IonList:g["y"],IonItem:g["w"],IonRadioGroup:g["F"],IonRow:g["H"]}});a("e96c");const $=_()(q,[["render",U],["__scopeId","data-v-546674a2"]]);var W=$,G=a("d1ca"),z=a("b446"),J=a("9ceb"),Q=a("8df6"),X=a("dac2"),K=a("5f2c"),Z=a("4db7"),ee=a("8e8b"),te=a("e86e"),ae=a("6d32"),ne=Object(n["defineComponent"])({mixins:[m["a"]],components:{HisStandardForm:s["a"]},data:()=>({fields:[],currentWeight:-1,weightTrail:[],customRegimens:[],labOrders:[],weightLossPercentageNum:0,lostTenPercentBodyWeight:!1,CxCaEnabled:!1,CxCaStartAge:-1,CxCaMaxAge:-1,DueForCxCa:!1,currentlyPregnant:!1,patientHitMenopause:!1,hasPregnancyObsToday:!1,autoSelect3HP:!1,labOrderFieldContext:{},consultation:{},prescription:{},dispensation:{},completed3HP:!1,hasTbHistoryObs:!1,allergicToSulphur:!1,TBSuspected:!1,presentedTBSymptoms:!1,askAdherence:!1,lastDrugsReceived:[],sideEffectsHistory:{},onPermanentFPMethods:!1,reasonForDecliningTPTObs:{},malawiSideEffectReasonObs:[],otherSideEffectReasonObs:[],wasTransferredIn:!1,dateStartedArt:"",clientHadAHysterectomy:!1,isNoneClientPatient:!1,tptStatus:{},customDrugs:[]}),watch:{ready:{handler(e){e&&(this.consultation=new d["a"](this.patientID,this.providerID),this.prescription=new X["a"](this.patientID,this.providerID),this.dispensation=new K["a"](this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){const a=await this.consultation.createEncounter();if(!a)return Object(l["e"])("Unable to create encounter");const n=await this.resolveObs(t,"consultation"),i=(await Promise.all([...this.malawiSideEffectReasonObs,...this.otherSideEffectReasonObs,this.reasonForDecliningTPTObs])).filter(e=>!Object(u["isEmpty"])(e)),o=await this.consultation.saveObservationList([...n,...i]);if(Object(u["isEmpty"])(this.drugObs)||this.isNoneClientPatient||await this.saveAdherence(),!o)return Object(l["e"])("Unable to save patient observations");Object(l["d"])("Observations and encounter created!"),e.refer_to_clinician&&"Yes"===e.refer_to_clinician.value?this.gotoPatientDashboard():this.nextTask()},async getTptDrugs(e){const t=[],a=e.routine_tb_therapy.value;return Object(u["isEmpty"])(this.customDrugs)&&(this.customDrugs=await ae["a"].getCustomIngridients()),a.match(/ipti/)?t.push("INH or H (Isoniazid 300mg tablet)"):a.includes("3HP (RFP + INH)")?(t.push("INH or H (Isoniazid 300mg tablet)"),t.push("Rifapentine (150mg)")):a.includes("INH 300 / RFP 300 (3HP)")&&t.push("INH 300 / RFP 300 (3HP)"),Object(u["isEmpty"])(t)?[]:this.customDrugs.filter(e=>t.includes(e.name)).map(e=>({label:e.name,value:"",other:e}))},async getTransferInStatus(){const e=await d["a"].getFirstValueCoded(this.patientID,"Ever received ART"),t=await d["a"].getFirstObs(this.patientID,"Has transfer letter"),a=t?c["b"].toStandardHisFormat(t.obs_datetime):"";return e&&e.match(/yes/i)&&t&&(""+t.value_coded).match(/yes/i)&&a===this.consultation.getDate()},async getDateStartedArt(){const e=await d["a"].getFirstValueDatetime(this.patientID,"Date ART started");return e?c["b"].toStandardHisFormat(e):""},async checkIfWeightLossIsControlled(e){if(this.lostTenPercentBodyWeight&&(""+e.label).match(/malnutrition/i)&&(""+e.value).match(/no/i)){const t=await Object(w["a"])("Recommendation",`Patient's weight has dropped by ${this.weightLossPercentageNum}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);e.value="Confirm weight loss"===t?"Yes":"No"}},async checkVLReminder(){const e=await P["a"].getPatientVLInfo(this.patientID);if(!0===e.eligibile){const t=await g["X"].create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{VLData:e}});t.present();const{data:a}=await t.onDidDismiss();switch(a){case"order":await this.labOrderFieldContext.launchOrderSelection();break;case"wait":await this.waitForVL();break;case"later":break;default:break}}},async waitForVL(e=null){const t=new S(this.patientID,this.providerID),a=await t.createEncounter(),n=await t.buildDefferedOrder(e);if(!a)return Object(l["e"])("Unable to create encounter");await t.saveObservationList(n)},canScreenCxCa(){const e=this.patient.getAge();return this.patient.isFemale()&&this.DueForCxCa&&this.CxCaEnabled&&e>=this.CxCaStartAge&&e<=this.CxCaMaxAge&&!this.clientHadAHysterectomy},pregnancyEligible(){return this.patient.isChildBearing()&&!this.onPermanentFPMethods},showCurrentContraceptionMethods(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isANCclient()},showNewContraceptionMethods(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isOnTubalLigation(e)&&!this.isANCclient()},isPregnant(e){return e.pregnant_breastfeeding?this.inArray(e.pregnant_breastfeeding,e=>"Pregnant"===e.label&&"Yes"===e.value):this.currentlyPregnant},isOnTubalLigation(e){return this.inArray(e.current_fp_methods,e=>"TUBAL LIGATION"===e.value)},async disableFPMethods(e,t){if(t.isChecked&&"NONE"===t.label)return e.map(e=>("NONE"!=e.label&&(e.isChecked=!1,e.disabled=!1),e));if("NONE"!=t.label&&t.isChecked){t.label.match(/condom/gi)&&Object(l["b"])("Combine with other modern methods of family planning");const a=Object(u["findIndex"])(e,{label:"NONE"});e[a].isChecked=!1;const n=this.consultation.familyPlanningMethods(t.label,e),i=Object(u["findIndex"])(n,{label:t.label});return n[i].isChecked=!0,n}return e.map(e=>(e.disabled=!1,e))},disablePrescriptions(e,t){if(t.isChecked&&"NONE OF THE ABOVE"===t.label)return e.map(e=>("NONE OF THE ABOVE"!=e.label&&(e.isChecked=!1),e));if("NONE OF THE ABOVE"!=t.label&&t.isChecked){const t=Object(u["findIndex"])(e,{label:"NONE OF THE ABOVE"});e[t].isChecked=!1}return e},buildMedicationOrders(e){if(this.inArray(e,e=>"NONE OF THE ABOVE"===e.label))return this.consultation.buildValueCoded("Prescribe drugs","No");const t=this.consultation.buildValueCoded("Prescribe drugs","Yes"),a=e.map(e=>this.consultation.buildValueCoded("Medication orders",e.label));return[t,...a]},declinedFPM(e){return this.inArray(e.fp_methods,e=>"NONE"===e.value)&&this.inArray(e.current_fp_methods,e=>"NONE"===e.value)},riskOfUnplannedPregnancy(e){return"At risk of unplanned pregnancy"===e.reason_for_no_fpm.value},showOtherSideEffects(e){return this.inArray(e.side_effects,e=>"Other"===e.label&&"Yes"===e.value)},hasTBSymptoms(e){return this.presentedTBSymptoms=this.inArray(e.tb_side_effects,e=>"Yes"===e.value),this.presentedTBSymptoms},async buildSideEffectObs(e,t){const a=await this.getSideEffectsReasons(e);if(this[t]=[],void 0===a)return!1;if(-1!=a){const e=b["a"].getCachedConceptID("Drug induced",!0),n=e=>!!(""+e).match(/other|drug/i);this[t]=a.map(t=>({concept_id:e,value_coded:b["a"].getCachedConceptID(t.label,!0),value_text:n(t.reason)?"Past medication history":null,value_drug:n(t.reason)?null:t.reason}))}return!0},async getSideEffectsReasons(e){const t=e.filter(e=>!(""+e.label).match(/other/i)&&"Yes"===e.value);if(t.length>0){const e=await g["X"].create({component:W,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:t,drugs:this.lastDrugsReceived}});e.present();const{data:a}=await e.onDidDismiss();return a}return-1},getFPMethods(e=[],t){const a=this.consultation.getFamilyPlanningMethods(),n=a.filter(t=>!e.includes(t));return n.map(e=>({label:e,value:e,isChecked:t.map(e=>e.label).includes(e)}))},getOptions(e,t){return e.map(e=>{const a=Object(u["find"])(t,{label:e});return{label:e,value:a?a.value:"",other:{values:this.yesNoOptions()}}})},getContraindications(e){const t=b["a"].getConceptsByCategory("contraindication",!0).map(e=>e.name);return this.getOptions([...t,"Other"],e)},getOtherContraindications(e){const t=b["a"].getConceptsByCategory("side_effect",!0).map(e=>e.name),a=t.pop();return this.getOptions([...t,"Other (Specify)",""+a],e)},getTBSymptoms(e){const t=b["a"].getConceptsByCategory("tb_symptom",!0).map(e=>e.name);return this.getOptions([...t],e)},getReasonsForNoCxcaOptions(){return b["a"].getConceptsByCategory("reason_for_no_cxca").map(e=>({label:e.name,value:e.name,other:{c:e}}))},runAppendOptionParams(e,t){const a=t.filter(e=>e.isChecked).map(e=>e.label);return e.map(e=>{var t;if("function"===typeof(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.appendOptionParams)){var n;const t=null===e||void 0===e||null===(n=e.other)||void 0===n?void 0:n.appendOptionParams();if("object"===typeof t){const n={label:e.label,value:e.value,other:e.other};return t.isChecked?(n.isChecked=t.isChecked,delete t.isChecked):n.isChecked=a.includes(e.label),{...n,...t}}}return e})},didCompleted3HP(e){return!!this.completed3HP||!(!e.routine_tb_therapy||!e.routine_tb_therapy.value.match(/complete/i))},tptAutoSelectionMode(e){return this.autoSelect3HP&&!this.didCompleted3HP(e)},async on3HPValueUpdate(e,t,a){const n=e=>!!e.label.match(/IPT|3HP/i),i=(()=>{const t=e.reduce((e,t)=>(n(t)&&!(t.label in e)&&t.isChecked&&e.push(t.label),e),[]);return t.includes("IPT")&&(t.includes("3HP (RFP + INH)")||t.includes("INH 300 / RFP 300 (3HP)"))})(),o=n(t)&&e.filter(e=>n(e)).map(e=>!e.isChecked).every(Boolean);if(o&&this.tptAutoSelectionMode(a)){const e=await Object(w["c"])("Reasons for declining TPT","",["Patient declined","Side-effects (previous or current)","Stock-out","Starting TB treatment","Other"],[{name:"Done",slot:"start",role:"action"}]);this.reasonForDecliningTPTObs=this.consultation.buildValueText("Other reason for not seeking services",e.selection)}else this.reasonForDecliningTPTObs={};if(i){const t=await Object(w["a"])("IPT / 3HP conflict","IPT and 3HP can NOT be prescribed together","Please pick either one",[{name:"Prescribe 3HP",slot:"start",color:"primary"},{name:"Prescribe IPT",slot:"end",color:"primary"}]);return e.map(e=>(n(e)&&(e.isChecked="Prescribe IPT"===t&&"IPT"===e.label||"Prescribe 3HP"===t&&"INH 300 / RFP 300 (3HP)"===e.label),e))}return e.map(e=>(("3HP (RFP + INH)"===t.label&&"INH 300 / RFP 300 (3HP)"===e.label&&t.isChecked||"INH 300 / RFP 300 (3HP)"===t.label&&"3HP (RFP + INH)"===e.label&&t.isChecked)&&(e.isChecked=!1),e))},medicationOrderOptions(e,t=[]){const a=this.didCompleted3HP(e),n=null!==this.tptStatus.tpt,i=this.tptAutoSelectionMode(e),o=e=>({disabled:!0,isChecked:!1,description:{color:"danger",show:"always",text:e}});return this.runAppendOptionParams([this.toOption("ARVs",{appendOptionParams:()=>({isChecked:i&&!this.TBSuspected})}),this.toOption("CPT",{appendOptionParams:()=>!i||this.TBSuspected||this.allergicToSulphur?this.allergicToSulphur?o("Allergic to CPT"):{disabled:!1}:{isChecked:!0}}),this.toOption("3HP (RFP + INH)",{appendOptionParams:()=>a?o("Completed TPT treatment"):this.TBSuspected?o("TB Suspect"):this.currentWeight<20?o("Weight below regulation"):n&&"3HP (RFP + INH)"!==this.tptStatus.tpt&&!this.tptStatus.completed?o(`On ${this.tptStatus.tpt} treatment`):"3HP (RFP + INH)"!==this.tptStatus.tpt||this.tptStatus.completed?void 0:{isChecked:!0}}),this.toOption("INH 300 / RFP 300 (3HP)",{appendOptionParams:()=>a?o("Completed TPT treatment"):this.TBSuspected?o("TB Suspect"):this.currentWeight<30?o("Weight below regulation"):n&&"INH 300 / RFP 300 (3HP)"!==this.tptStatus.tpt&&!this.tptStatus.completed?o(`On ${this.tptStatus.tpt} treatment`):"INH 300 / RFP 300 (3HP)"!==this.tptStatus.tpt||this.tptStatus.completed?{isChecked:i}:{isChecked:!0}}),this.toOption("IPT",{appendOptionParams:()=>a?o("Completed TPT treatment"):this.TBSuspected?o("TB Suspect"):n&&"IPT"!==this.tptStatus.tpt&&!this.tptStatus.completed?o(`On ${this.tptStatus.tpt} treatment`):"IPT"!==this.tptStatus.tpt||this.tptStatus.completed?void 0:{isChecked:!0}}),this.toOption("NONE OF THE ABOVE")],t)},async getVlLabData(){return p["a"].formatLabs(await ee["a"].get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}))},isANCclient(){return"ANC"===P["a"].getSuspendedProgram()},getFields(){return[{id:"other_patient_prescription",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:o["b"].TT_MULTIPLE_SELECT,init:async()=>{const e="No"===await this.consultation.getClient();return this.isNoneClientPatient=!!e||!!await Q["a"].isDrugRefillPatient(this.patientID),this.isNoneClientPatient&&(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await ee["a"].get("ART_AUTO_3HP_SELECTION"),this.tptStatus=await this.consultation.getTptTreatmentStatus(),this.completed3HP=null!==this.tptStatus.tpt&&this.tptStatus.completed),!0},validation:e=>r["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.buildMedicationOrders(e)}),onValueUpdate:(e,t,a)=>{const n=this.disablePrescriptions(e,t);return this.on3HPValueUpdate(n,t,a)},options:(e,t,a,n)=>Object(u["isEmpty"])(n)?this.medicationOrderOptions(e):n,condition:()=>this.isNoneClientPatient,exitsForm:()=>!0},...Object(z["b"])({id:"date_last_received_arvs",helpText:"Last ARV Dispensation",required:!0,init:async()=>(this.wasTransferredIn=await this.getTransferInStatus()||!1,this.dateStartedArt=await this.getDateStartedArt(),!0),condition:()=>this.wasTransferredIn,minDate:()=>this.dateStartedArt,maxDate:()=>this.consultation.getDate(),computeValue:e=>(this.prescription.setDate(e),{tag:"consultation",date:e,obs:this.consultation.buildValueDate("Date drug received from previous facility",e)}),estimation:{allowUnknown:!1}},this.consultation.getDate()),{id:"previous_arvs_received",helpText:"Last ARV drugs dispensed",type:o["b"].TT_MULTIPLE_SELECT,computedValue:e=>e.map(e=>e.other),validation:e=>r["a"].required(e),options:async()=>{if(!Object(u["isEmpty"])(this.customRegimens))return this.customRegimens;const e=new X["a"](this.patientID,this.providerID);return this.customDrugs=await e.getCustomIngridients(),this.customRegimens=this.customDrugs.map(e=>({label:e.name,value:e.drug_id,other:{...e}})),this.customRegimens},config:{showKeyboard:!0},condition:()=>this.wasTransferredIn},{id:"drug_interval",helpText:"Duration period for last received ARVs",type:o["b"].TT_NEXT_VISIT_INTERVAL_SELECTION,condition:()=>this.wasTransferredIn,validation:e=>r["a"].required(e),computedValue:e=>e.other.nextAppointment,options:()=>{const e=[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}];return e.map(({label:e,value:t})=>{this.prescription.setNextVisitInterval(t);const a=this.prescription.calculateDateFromInterval();return{label:e,value:t,other:{label:"Medication run-out date:",value:c["b"].toStandardHisDisplayFormat(a),nextAppointment:a,other:{label:"",value:[]}}}})}},{id:"arv_quantities",helpText:"Amount of drugs dispensed (From last ART Facility)",type:o["b"].TT_DRUG_TRANSFER_IN,validation:e=>this.validateSeries([()=>r["a"].required(e),()=>e.map(e=>{var t;return""===e.value||""===(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.pillsBrought)}).some(Boolean)?["Some Drugs are missing values"]:null]),computedValue:(e,t,a)=>({tag:"consultation",obs:e.map(async e=>{var t,n,i,o;const s=(null===e||void 0===e||null===(t=e.other)||void 0===t||null===(n=t.drug)||void 0===n?void 0:n.drug_id)||0;return{...await this.consultation.buildObs("Drug received from previous facility",{value_drug:s,value_datetime:(null===a||void 0===a?void 0:a.drug_interval)||null,value_numeric:(null===e||void 0===e?void 0:e.value)||0}),child:await this.consultation.buildObs("Number of tablets brought to clinic",{value_drug:s,value_numeric:(null===e||void 0===e||null===(i=e.other)||void 0===i?void 0:i.pillsBrought)||-1,value_datetime:(null===a||void 0===a||null===(o=a.date_last_received_arvs)||void 0===o?void 0:o.date)||null})}})}),options:(e,t,a)=>t.previous_arvs_received.map(e=>{const t=e["alternative_drug_name"]||e["drug_name"]||e["name"],n=Object(u["find"])(a,{label:t});let i="",o="";var s;n&&(i=null===n||void 0===n?void 0:n.value,o=null===n||void 0===n||null===(s=n.other)||void 0===s?void 0:s.pillsBrought);return{label:t,value:i,other:{drug:e,pillsBrought:o}}}),condition:()=>this.wasTransferredIn},{id:"patient_lab_orders",helpText:"Lab orders",type:o["b"].TT_LAB_ORDERS,init:async()=>(this.labOrders=await this.getVlLabData(),!0),unload:async()=>{await this.checkVLReminder();const e=this.labOrders.filter(e=>"No"===e.result_given);if(e.length&&await Object(l["a"])("Result(s) Given to Client?")){const t=new A["a"](this.patientID,-1,this.providerID),a=e.reduce((e,a)=>[...e,...a.resultIds.map(async e=>(t.encounterID=a.encounter_id,t.saveObs(await t.buildObs("Result Given to Client",{value_coded:"Yes",obs_group_id:e}))))],[]);await Promise.all(a)}this.labOrders=await this.getVlLabData()},onload:e=>this.labOrderFieldContext=e,options:()=>[{label:"Lab orders",value:"order trail",other:{values:this.labOrders}}],config:{printOrder:e=>new Z["a"](this.patientID).printLabOrderLbl(e),hiddenFooterBtns:["Clear"],footerBtns:[{name:"Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>{Object(u["isEmpty"])(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection()}}]}},{id:"pregnant_breastfeeding",helpText:"Patient Pregnant or breastfeeding?",init:async()=>(this.patient.isFemale()&&(this.patient.isChildBearing()&&(this.hasPregnancyObsToday=await this.patient.hasPregnancyObsToday(),this.currentlyPregnant=await this.patient.isPregnant()),this.onPermanentFPMethods=await this.consultation.getTLObs()),!0),condition:()=>!this.hasPregnancyObsToday&&this.pregnancyEligible(),type:o["b"].TT_MULTIPLE_YES_NO,validation:e=>this.validateSeries([()=>r["a"].required(e),()=>r["a"].anyEmpty(e)]),computedValue:e=>{let t=[];return this.isANCclient()&&t.push(this.consultation.buildValueCoded("Is patient pregnant","Yes")),t=t.concat(e.map(e=>this.consultation.buildValueCoded(e.other.concept,e.value))),{obs:t,tag:"consultation"}},options:e=>{const t=[];return this.isANCclient()||t.push({label:"Pregnant",value:"",other:{values:this.yesNoOptions(),concept:"Is patient pregnant"}}),t.push({label:"Breastfeeding",value:"",other:{values:this.yesNoOptions(),concept:"Is patient breast feeding"}}),e.pregnant_breastfeeding||t}},{id:"patient_weight_chart",helpText:"Patient weight chart",type:o["b"].TT_WEIGHT_CHART,init:async()=>(this.weightTrail=await this.patient.getWeightHistory(),this.weightLossPercentageNum=this.patient.getWeightLossPercentageFromTrail(this.weightTrail),this.lostTenPercentBodyWeight=this.weightLossPercentageNum>=10,!0),options:async()=>{const e=await this.patient.getBMI(),t=this.weightTrail;return[{label:"Weight for patient",value:"Weight trail",other:{bmi:e,values:t.map(e=>({x:c["b"].toStandardHisDisplayFormat(e.date),y:e.weight})),age:this.patient.getAge()}}]},config:{hiddenFooterBtns:["Clear"]}},{id:"has_fp_methods",helpText:"",type:o["b"].TT_TEXT_BANNER,condition:()=>this.onPermanentFPMethods,options:()=>this.mapStrToOptions(["Patient is on Tubal ligation method"])},{id:"current_fp_methods",helpText:"What method are you currently on?",type:o["b"].TT_MULTIPLE_SELECT,init:async()=>(this.patient.isFemale()&&(this.patientHitMenopause=await this.consultation.patientHitMenopause()),!0),validation:e=>r["a"].required(e),onValueUpdate:(e,t)=>this.disableFPMethods(e,t),computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded("Family planning method",e.value))}),condition:e=>this.showCurrentContraceptionMethods(e),options:(e,t)=>this.getFPMethods([],t)},{id:"fp_methods",helpText:"What method are you providing today?",type:o["b"].TT_MULTIPLE_SELECT,condition:e=>this.showNewContraceptionMethods(e),validation:e=>r["a"].required(e),onValueUpdate:(e,t)=>this.disableFPMethods(e,t),computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded("Family planning, action to take",e.value))}),options:(e,t)=>this.getFPMethods([],t)},{id:"reason_for_no_fpm",helpText:"Main reason for not using family planning methods",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),condition:e=>this.declinedFPM(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Why does the woman not use birth control",e.value)}),options:()=>this.mapStrToOptions(["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"])},{id:"specific_reason_for_no_fpm",helpText:"Specific reason for not using family planning methods",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Reason for not using contraceptives",e.value)}),condition:e=>this.riskOfUnplannedPregnancy(e),options:()=>this.mapStrToOptions(["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"])},{id:"offer_contraceptives",helpText:"Offer contraceptives",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),condition:e=>this.riskOfUnplannedPregnancy(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Family planning, action to take",e.value)}),options:()=>[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]},{id:"offered_intervention",helpText:"Offered intervention",type:o["b"].TT_MULTIPLE_SELECT,validation:e=>r["a"].required(e),condition:e=>"Accepted"===e.offer_contraceptives.value,computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded(e.label,e.value))}),options:(e,t)=>this.getFPMethods(["NONE"],t)},{id:"offer_cxca",helpText:"Refer client for CxCa screening",type:o["b"].TT_SELECT,init:async()=>{if(this.patient.isFemale()&&(this.CxCaEnabled=await G["b"].cervicalCancerScreeningEnabled(),this.CxCaEnabled)){const{start:e,end:t}=await G["b"].cervicalCancerScreeningAgeBounds();this.CxCaMaxAge=t,this.CxCaStartAge=e,this.DueForCxCa=await this.consultation.clientDueForCxCa(),this.clientHadAHysterectomy=await this.consultation.clientHasHadAHysterectomy()}return!0},validation:e=>r["a"].required(e),condition:e=>this.canScreenCxCa()&&!this.isPregnant(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Offer CxCa",e.value)}),options:()=>this.yesNoOptions()},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),condition:e=>"No"===e.offer_cxca.value,computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Reason for NOT offering CxCa",e.value)}),options:()=>this.getReasonsForNoCxcaOptions()},...Object(z["b"])({id:"previous_cxca_test_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>d["a"].getSessionDate(),condition:e=>"Not due for screening"===e.reason_for_no_cxca.value,computeValue:(e,t)=>t?{tag:"consultation",obs:this.consultation.buildValueDateEstimated("CxCa test date",e)}:{tag:"consultation",obs:this.consultation.buildValueDate("CxCa test date",e)},estimation:{allowUnknown:!0,estimationFieldType:z["a"].MONTH_ESTIMATE_FIELD}}),{id:"previous_side_effects",helpText:"Side effects / Contraindications history",type:o["b"].TT_DATA_TABLE,init:async()=>(this.sideEffectsHistory=await this.consultation.getDrugSideEffects(),!0),config:{columns:()=>[[J["a"].thTxt("Date"),J["a"].thTxt("Condition"),J["a"].thTxt("Drug induced"),J["a"].thTxt("Drug")]],rows:()=>Object.keys(this.sideEffectsHistory).map(e=>Object.values(this.sideEffectsHistory[e]).filter(e=>!Object(u["isEmpty"])(e.name)).map(t=>[J["a"].tdDate(e),J["a"].td(t.name),J["a"].td(t.drug_induced?"Yes":"No"),J["a"].td(t.drug)])).reduce((e,t)=>e.concat(t),[])}},{id:"side_effects",helpText:"Contraindications / Side effects (select either 'Yes' or 'No')",type:o["b"].TT_MULTIPLE_YES_NO,init:async()=>(this.lastDrugsReceived=await this.consultation.getPreviousDrugs(),!0),validation:e=>this.validateSeries([()=>r["a"].required(e),()=>r["a"].anyEmpty(e)]),computedValue:e=>({tag:"consultation",obs:e.map(async e=>({...await this.consultation.buildValueCoded("Malawi ART side effects",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))}),beforeNext:e=>this.buildSideEffectObs(e,"malawiSideEffectReasonObs"),options:(e,t)=>this.getContraindications(t)},{id:"other_side_effects",helpText:"Other Contraindications / Side effects (select either 'Yes' or 'No')",type:o["b"].TT_MULTIPLE_YES_NO,onValue:async e=>(await this.checkIfWeightLossIsControlled(e),!0),condition:e=>this.showOtherSideEffects(e),onConditionFalse:()=>this.otherSideEffectReasonObs=[],validation:e=>this.validateSeries([()=>r["a"].required(e),()=>r["a"].anyEmpty(e)]),computedValue:e=>({tag:"consultation",obs:e.filter(e=>"Other (Specify)"!=e.label).map(async e=>({...await this.consultation.buildValueCoded("Other side effect",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))}),beforeNext:e=>this.buildSideEffectObs(e,"otherSideEffectReasonObs"),options:(e,t)=>this.getOtherContraindications(t)},{id:"other_side_effect_specify",helpText:"Other Contraindications / Side effects (specify)",type:o["b"].TT_NOTE,computedValue:async e=>({tag:"consultation",obs:{...await this.consultation.buildValueCoded("Other side effect","Other (Specify)"),child:await this.consultation.buildValueText("Other (Specify)",e.value)}}),condition:e=>this.inArray(e.other_side_effects,e=>"Other (Specify)"===e.label&&"Yes"===e.value),validation:e=>r["a"].required(e)},{id:"on_tb_treatment",helpText:"On TB Treatment?",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),computedValue:e=>{this.TBSuspected="Yes"===e.value;const t=[this.consultation.buildValueCoded("TB treatment",e.value)];return this.TBSuspected&&t.push(this.consultation.buildValueCoded("TB Status","Confirmed TB on treatment")),{tag:"consultation",obs:t}},options:()=>this.yesNoOptions()},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:o["b"].TT_MULTIPLE_YES_NO,onValue:async e=>(await this.checkIfWeightLossIsControlled(e),!0),validation:e=>this.validateSeries([()=>r["a"].required(e),()=>r["a"].anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>this.getTBSymptoms(t),computedValue:e=>(this.presentedTBSymptoms=this.inArray(e,e=>"Yes"===e.value),{tag:"consultation",obs:e.map(async e=>({...await this.consultation.buildValueCoded("Routine TB Screening",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))})},{id:"tb_status",helpText:"TB Status",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),condition:e=>this.hasTBSymptoms(e),onConditionFalse:()=>this.TBSuspected=!1,defaultValue:()=>"TB Suspected",computedValue:e=>(this.TBSuspected="TB Suspected"===e.value,{tag:"consultation",obs:this.consultation.buildValueCoded("TB Status",e.value)}),beforeNext:async e=>{if("TB Suspected"===e.value){const e=await Object(w["a"])("Lab Order","The patient is a TB suspect. Do you want to take lab orders?","",[{name:"Order now",slot:"start",color:"success"},{name:"NOT now",slot:"end",color:"danger"}]);"Order now"===e&&this.labOrderFieldContext.launchOrderSelection(["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"])}return!0},options:()=>this.mapStrToOptions(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"])},{id:"routine_tb_therapy",helpText:"TB preventive therapy (TPT) history",type:o["b"].TT_SELECT,init:async()=>(this.hasTbHistoryObs=await this.consultation.hasTreatmentHistoryObs(),!0),validation:e=>r["a"].required(e),condition:()=>!this.hasTbHistoryObs,computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Previous TB treatment history",e.value)}),options:()=>this.mapStrToOptions(["Currently on IPT","Currently on 3HP (RFP + INH)","Currently on INH 300 / RFP 300 (3HP)","Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP (RFP + INH) in the past","Aborted course of INH 300 / RFP 300 (3HP) in the past","Aborted course of IPT in the past","Never taken IPT or 3HP"])},...Object(z["b"])({id:"date_started_tpt",helpText:"Started TPT Treatment",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>d["a"].getSessionDate(),condition:e=>e.routine_tb_therapy.value.match(/currently/i),computeValue:e=>e,estimation:{allowUnknown:!0,estimationFieldType:z["a"].MONTH_ESTIMATE_FIELD}}),{id:"tpt_drugs_received",helpText:"TPT Drugs Received",required:!0,condition:e=>e.routine_tb_therapy.value.match(/currently/i),type:o["b"].TT_ADHERENCE_INPUT,options:e=>this.getTptDrugs(e),computedValue:(e,t,a)=>({tag:"consultation",obs:e.map(async e=>{var t;return this.consultation.buildObs("TPT Drugs Received",{value_drug:(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.drug_id)||0,value_datetime:(null===a||void 0===a?void 0:a.date_started_tpt)||null,value_numeric:(null===e||void 0===e?void 0:e.value)||0})})}),config:{titles:{label:"Drug name",value:"Tablets received"}}},{id:"tpt_tranfer_from",helpText:"Facility client is transferring in from",type:o["b"].TT_SELECT,computedValue:({label:e})=>({tag:"consultation",obs:this.consultation.buildValueText("Location TPT last received",e)}),validation:e=>r["a"].required(e),condition:e=>e.routine_tb_therapy.value.match(/currently/i),options:(e,t="")=>Object(te["b"])(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"allergic_to_sulphur",helpText:"Allergic to Cotrimoxazole",type:o["b"].TT_SELECT,validation:e=>r["a"].required(e),computedValue:e=>(this.allergicToSulphur=e.value.match(/unknown/i)?null:!!e.value.match(/yes/i),{tag:"consultation",obs:()=>this.consultation.buildValueCoded("Allergic to sulphur",null===this.allergicToSulphur?e.value:this.allergicToSulphur?"Yes":"No")}),options:()=>this.yesNoUnknownOptions()},...this.getAdherenceFields(!0),{id:"refer_to_clinician",helpText:"Refer to clinician",type:o["b"].TT_SELECT,condition:()=>h["a"].isNurse(),validation:e=>r["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Refer to clinician",e.value)}),options:()=>this.yesNoOptions()},{id:"medication_to_prescribe",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:o["b"].TT_MULTIPLE_SELECT,init:async()=>(this.isNoneClientPatient||(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await ee["a"].get("ART_AUTO_3HP_SELECTION"),this.tptStatus=await this.consultation.getTptTreatmentStatus(),this.completed3HP=null!==this.tptStatus.tpt&&this.tptStatus.completed),!0),condition:e=>!e.refer_to_clinician||(""+e.refer_to_clinician.value).match(/no/i),validation:e=>r["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.buildMedicationOrders(e)}),onValueUpdate:(e,t,a)=>{const n=this.disablePrescriptions(e,t);return this.on3HPValueUpdate(n,t,a)},options:(e,t,a,n)=>this.medicationOrderOptions(e,n),config:{footerBtns:[{name:"Update allergic to CPT",onClickComponentEvents:{refreshOptions:(e,t,a)=>(this.allergicToSulphur="Allergic"===e.btnOutput,this.medicationOrderOptions(a,t))},onClick:()=>Object(w["a"])("Allergic to Cotrimoxazole update","Is the patient allergic to cotrimoxazole.","",[{name:"Allergic",slot:"start",color:"success"},{name:"NOT Allergic",slot:"end"}])}]}}]}}});const ie=_()(ne,[["render",i]]);t["default"]=ie},b446:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return C}));a("13d5");var n,i=a("d95e"),o=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],s=a("9283"),r=a("2706"),l=a("3800"),c=a("6be2"),u=a("5a0c"),d=a.n(u),h=a("1c74");function p(e,t,a=!0){const n=[];return a&&n.push("UNKNOWN"),{id:e,helpText:t+" Year",appearInSummary:()=>!1,type:i["b"].TT_TEXT,config:{customKeyboard:[l["i"],[n,["DELETE"]]]}}}function b(e,t){return{id:e,helpText:t+" Month",appearInSummary:()=>!1,type:i["b"].TT_SELECT,options:()=>o}}function m(e,t){return{id:e,helpText:t+" Day",type:i["b"].TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function g(e,t){return{id:e,helpText:t+" Estimated period",type:i["b"].TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function T(e,t){return{id:e,helpText:t+" Age Estimate",type:i["b"].TT_NUMBER,appearInSummary:()=>!1,config:{keypad:c["e"]}}}function f(e){return parseInt(e)<10?"0"+e:e}async function O(e,t,a){if(t.defaultValue){const n=await t.defaultValue(e);if(n){const[e,t,i]=n.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(i)||""}}}return""}function v(e){return s["b"].toStandardHisDisplayFormat(e)}function y(e,t,a,n){if(t.minDate){const i=t.minDate(a,n);if(new Date(e)<new Date(i))return[`${v(e)} is less than minimum date of ${v(i)}`]}if(t.maxDate){const i=t.maxDate(a,n);if(i&&new Date(e)>new Date(i))return[`${v(e)} is greater than max date of  ${v(i)}`]}}function C(e,t=""){let a="",i="",l="",c="",u=!1;const C="year_"+e.id,N="month_"+e.id,E="day_"+e.id,_="age_estimate_"+e.id,I="duration_estimate_"+e.id,D=p(C,e.helpText,e.estimation.allowUnknown),P=b(N,e.helpText),A=m(E,e.helpText),S=T(_,e.helpText),w=g(I,e.helpText),V="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,R=t=>!(t[C]&&t[C].value&&["Unknown"].includes(t[C].value))&&(!e.condition||e.condition(t)),L=(e,t)=>{const a=[{type:"year",value:i,default:"YYYY"},{type:"month",value:l,default:"MM"},{type:"day",value:c,default:"DD"}];return a.reduce((a,n)=>{const i=[null,void 0,"Unknown",""];return t===n.type?i.includes(e)?a.push(n.default):a.push(e):i.includes(n.value)?a.push(n.default):a.push(n.value),a},[]).join("-")};"function"===typeof e.init&&(D.init=e.init),D.updateHelpTextOnValue=e=>`${D.helpText} (${L(null===e||void 0===e?void 0:e.label,"year")})`,D.proxyID=e.id,D.unload=e=>i=e.value.toString(),D.config={...D.config,...e.config},D.defaultValue=t=>O(t,e,"Year"),D.condition=t=>!e.condition||e.condition(t),D.validation=(t,a,n)=>{if(e.required&&r["a"].required(t))return["Year cannot be empty"];const i=t?t.value:"";if(!e.estimation.allowUnknown&&i.toString().match(/unknown/i))return["Value unknown is not permitted"];if(i&&!["Unknown"].includes(i)&&isNaN(i)||i<1900)return["Invalid Year"];if(i&&"function"===typeof e.minDate){const t=s["b"].getYear(e.minDate(a,n));if(parseInt(i)<t)return[`Year of ${i} is less than Minimum year of ${t}`]}if(i&&"function"===typeof e.maxDate){const t=e.maxDate(a,n);if(t&&i>s["b"].getYear(t))return[`Year of ${i} exceeds Maximum year of ${s["b"].getYear(t)}`]}return null},D.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?v(a):"Unknown"}),D.appearInSummary=(t,a)=>a===e.id,D.computedValue=t=>{if(a){const[n,i,o]=a.split("-");return a=`${t.value}-${i}-${o}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},P.updateHelpTextOnValue=e=>`${P.helpText} (${L(null===e||void 0===e?void 0:e.label,"month")})`,P.proxyID=e.id,P.unload=e=>l=f(e.value.toString()),P.condition=e=>R(e),P.validation=e=>r["a"].required(e),P.defaultValue=t=>O(t,e,"Month"),V&&(P.options=()=>[...o,{label:"Unknown",value:"Unknown"}]),P.computedValue=(t,n)=>{if((""+t.value).match(/unknown/i))return a=n[C].value+"-07-15",e.computeValue(a,!0);if(a){const[n,i,o]=a.split("-"),s=f(""+t.value);return a=`${n}-${s}-${o}`,e.computeValue(a,!1)}},A.proxyID=e.id,A.updateHelpTextOnValue=e=>`${A.helpText} (${L(null===e||void 0===e?void 0:e.label,"day")})`,A.condition=e=>!(""+e[N].value).match(/unknown/i)&&R(e),A.validation=(t,n,o)=>r["a"].required(t)?["Day is required for date"]:(u=!!(""+t.value).match(/unknown/i),c=u?"15":f(""+t.value),a=`${i}-${l}-${c}`,y(a,e,n,o)),A.defaultValue=t=>O(t,e,"Day"),A.computedValue=()=>e.computeValue(a,u),A.unload=(t,a,n,i)=>{e.unload&&e.unload(t,a,n,i)},A.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),A.config={year:e=>e[C].value,month:e=>e[N].value},V||(A.config.keyboardActions=[]);const x=(t,a)=>{const n=["Unknown"===t[C].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return n.every(Boolean)};return S.proxyID=e.id,S.validation=(t,n,i)=>{if(t&&t.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(t.value.toString())))return["Please enter a valid number"];const o=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!t.value.toString().match(o))return["Not a valid age estimate"];const s=d()(h["e"].getSessionDate()).subtract(t.value,"years").year();return a=s+"-07-15",y(a,e,n,i)},S.condition=e=>x(e,n.AGE_ESTIMATE_FIELD),S.computedValue=()=>e.computeValue(a,!0),S.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),w.proxyID=e.id,w.validation=(t,n,i)=>r["a"].required(t)?["Please select an estimate"]:(a=d()(h["e"].getSessionDate()).subtract(t.value,"day").format(s["a"]),y(a,e,n,i)),w.condition=e=>x(e,n.MONTH_ESTIMATE_FIELD),w.computedValue=()=>e.computeValue(a,!0),w.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),[D,P,A,S,w]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(n||(n={}))},d42f:function(e,t,a){"use strict";a("1c3d")},e86e:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"a",(function(){return u})),a.d(t,"g",(function(){return d})),a.d(t,"h",(function(){return h}));var n=a("5713"),i=a("2ef0");async function o(e=""){const t=await n["a"].getFacilities({name:e});return t.filter(e=>!Object(i["isEmpty"])(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function s(e=""){const t=await n["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function r(e=""){const t=await n["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function l(){const e=await n["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function c(){const e=await n["a"].getRegions();return e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function u(e){const t=await n["a"].getDistricts(e);return t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function d(e,t=""){const a=await n["a"].getTraditionalAuthorities(e,t);return a.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function h(e,t=""){const a=await n["a"].getVillages(e,t);return a.map(e=>({label:e.name,value:e.village_id,other:e}))}},e96c:function(e,t,a){"use strict";a("113a")},fe96:function(e,t,a){"use strict";var n=a("7a23"),i=a("d95e"),o=a("b5e4"),s=a("1da1"),r=a("d4ec"),l=a("bee2"),c=a("262e"),u=a("2caf"),d=(a("96cf"),a("d3b7"),a("d81d"),a("4de4"),a("caad"),a("2532"),a("25f0"),a("cc6f")),h=a("9283"),p=a("2ef0"),b=a("32b3"),m=a("5a0c"),g=a.n(m),T=function(e){Object(c["a"])(a,e);var t=Object(u["a"])(a);function a(e,n){var i;return Object(r["a"])(this,a),i=t.call(this,e,68,n),i.lastDrugs=[],i.lastReceiptDate="",i}return Object(l["a"])(a,[{key:"loadPreviousDrugs",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a,n,i,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new Date(this.date),t.setDate(t.getDate()-1),a=function(e){return h["b"].toStandardHisFormat(e)},e.next=5,d["a"].getJson("patients/".concat(this.patientID,"/drugs_received"),{date:a(t)});case 5:n=e.sent,n&&(this.lastReceiptDate=n.reduce((function(e,t){return!e||new Date(a(t.order.start_date))>new Date(e)?a(t.order.start_date):e}),null),i=b["a"].htnDrugReferences().map((function(e){return e.drug_id})),this.lastDrugs=n.filter((function(e){return!i.includes(e.drug["drug_id"])&&a(e.order.start_date)===o.lastReceiptDate})));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getReceiptDate",value:function(){return this.lastReceiptDate}},{key:"getLastDrugs",value:function(){return this.lastDrugs}},{key:"receivedDrugsBefore",value:function(){return!Object(p["isEmpty"])(this.lastDrugs)}},{key:"buildPillCountObs",value:function(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}},{key:"buildAdherenceObs",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,a,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d["a"].getConceptID("Drug adherence",!0);case 2:return i=e.sent,e.abrupt("return",{concept_id:i,value_numeric:n,value_drug:a,value_modifier:"%",order_id:t,person_id:this.patientID,obs_datetime:d["a"].getSessionDate()});case 4:case"end":return e.stop()}}),e,this)})));function t(t,a,n){return e.apply(this,arguments)}return t}()},{key:"isAdherenceGood",value:function(e){return e>=95&&e<=105}},{key:"calculateAdherence",value:function(e,t,a){return Math.round(100*(e-t)/(e-a))}},{key:"calculateExpected",value:function(e,t,a,n){var i="QW"===n?"week":"day",o=this.calcTimeElapsed(a,i);return e-o*parseFloat(t.toString())}},{key:"calcTimeElapsed",value:function(e,t){return g()(this.date).diff(e,t)}},{key:"calculateUnaccountedOrMissed",value:function(e,t){var a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}}]),a}(d["a"]),f=a("7365"),O=a("2706"),v=Object(n["defineComponent"])({mixins:[f["a"]],data:()=>({adherence:{},drugObs:[],askReasonForPoorAdherence:!1,calculationAgreementObs:[]}),methods:{async saveAdherence(){await this.adherence.createEncounter();const e=await Promise.all([...this.drugObs,...this.calculationAgreementObs]),t=await this.adherence.saveObservationList(e);if(!t)return Object(o["e"])("Unable to save patient observations")},buildAdherenceReport(e){const t=this.adherence.getReceiptDate(),a=this.adherence.calcTimeElapsed(t,"day"),n=` Last visit: ${h["b"].toStandardHisDisplayFormat(t)} \n                (${a} Days Elapsed)`,i=[{indexes:[0,3,6],class:"adherence-col-bg"}],o=[],s=[n],r=[["Prescription"],["Tabs given"],["Tabs per"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];return e.forEach((e,t)=>{const a=this.formatFrequency(e.frequency),n=this.calcPillsExpected(e),i=this.adherence.calculateAdherence(e.quantity,e.pillsBrought,n),l=this.adherence.isAdherenceGood(i)?"Good adherence":"Explore problem",c=this.adherence.calculateUnaccountedOrMissed(n,e.pillsBrought);s.push(e.drug.name),r[0].push(""),r[1].push(e.quantity),r[2].push(`${e.equivalent_daily_dose} <b>${a}</b>`),r[3].push(""),r[4].push(n<0?0:n),r[5].push(e.pillsBrought),r[6].push(""),r[7].push(c),r[8].push(i+"%"),r[9].push(l),o.push({index:t+1,row:9,class:l.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})}),[{label:"Selected Medication",value:"Table",other:{columns:s,rows:r,rowColors:i,cellColors:o}}]},formatFrequency(e){return(""+e).match(/qod/i)?"QOD":(""+e).match(/weekly/i)?"QW":e},calcPillsExpected(e){return this.adherence.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,this.formatFrequency(e.frequency))},getAdherenceFields(e=!1){return[{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:i["b"].TT_ADHERENCE_INPUT,init:async()=>(this.adherence=new T(this.patientID,this.providerID),await this.adherence.loadPreviousDrugs(),!0),condition:()=>!e||this.adherence.receivedDrugsBefore(),validation:e=>{if(O["a"].required(e))return["No drugs available"];const t=e.map(e=>""===e.value);return t.some(Boolean)?["Some values are missing"]:null},unload:async e=>{this.drugObs=[],e.forEach(async e=>{const{drug:t,order:a}=e.other,n={...e.other,pillsBrought:e.value},i=this.adherence.calculateAdherence(n.quantity,n.pillsBrought,this.calcPillsExpected(n));this.drugObs.push(this.adherence.buildAdherenceObs(a.order_id,t.drug_id,i)),this.drugObs.push(this.adherence.buildPillCountObs(a.order_id,e.value)),this.askReasonForPoorAdherence||(this.askReasonForPoorAdherence=!this.adherence.isAdherenceGood(n))})},options:e=>Object(p["isEmpty"])(e.pills_brought)?this.adherence.getLastDrugs().map(e=>({label:e.drug.name,value:"",other:{...e}})):e.pills_brought},{id:"adherence_report",helpText:"ART adherence",type:i["b"].TT_TABLE_VIEWER,condition:()=>!e||this.adherence.receivedDrugsBefore(),options:e=>this.buildAdherenceReport(e.pills_brought.map(e=>({...e.other,pillsBrought:e.value}))),config:{hiddenFooterBtns:["Clear"]}},{id:"agree_with_calculation",helpText:"Agree with adherence calculation",type:i["b"].TT_SELECT,condition:()=>this.askReasonForPoorAdherence,validation:e=>O["a"].required(e),unload:({value:e})=>{this.calculationAgreementObs=[this.adherence.buildValueCoded("Reason for poor treatment adherence",e)]},options:()=>[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}]}}});const y=v;t["a"]=y}}]);
//# sourceMappingURL=chunk-7f9749ab.60ae4d8d.js.map