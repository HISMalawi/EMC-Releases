import{d as m,I as c,L as o,cx as h,ab as n,_ as u,r as p,o as w,c as _,w as f,b as P}from"./index-hoLU9YgK.js";import{a as R}from"./regimen_report_service-eKoNUL6-.js";import{_ as v}from"./ReportMixin.vue_vue_type_script_lang-VKPiCK7V.js";import{R as H}from"./TableReportTemplate-w1n0QulW.js";import{M as T}from"./moh_cohort_service--b6B-WzT.js";import"./MultiFieldDateHelper-PDSV6pPV.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./BasicReportTemplate-7WBogXGX.js";import"./Export-g1vHKjsV.js";import"./SIngleTouchField-iKsJUYy8.js";import"./Pagination-Ex8Q9IMR.js";import"./HisStandardForm-rzQ2tZDj.js";import"./TouchScreenForm-3AdFBAzj.js";import"./ToolbarMediumCard-8sJVQ55x.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-kkmofE00.js";import"./ReportErrors-9sOxwrH3.js";const I=m({mixins:[v],components:{ReportTemplate:H,IonPage:c},data:()=>({title:"TPT new initiations report",rows:[],cohort:{},canValidate:!1,mohCohort:{},headerList:[],errors:[],showStatus:!1,columns:[[o.thTxt("District"),o.thTxt("Age group"),o.thTxt("Gender"),o.thNum("3HP (Started New on ART)"),o.thNum("6H (Started New on ART)"),o.thNum("3HP (Started Previously on ART)"),o.thNum("6H (Started Previously on ART)")]],totalIpt:[],total3hp:[]}),watch:{async canValidate(t){t&&await this.validateReport()}},created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(t,i){this.canValidate=!1,this.rows=[],this.errors=[],this.showStatus=!1,this.totalIpt=[],this.total3hp=[],this.report=new R,this.mohCohort=new T,this.mohCohort.setStartDate(i.start_date),this.mohCohort.setEndDate(i.end_date),this.mohCohort.setOccupation(i.occupation),this.report.setOccupation(i.occupation),this.report.setStartDate(i.start_date),this.report.setEndDate(i.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getTptNewInitiations(),this.setRows("F"),this.setRows("M"),this.canValidate=!0,this.showStatus=!0},drilldown(t,i){const r=[[o.thTxt("ARV #"),o.thTxt("DOB"),o.thTxt("Dispensed date")]],e=()=>this.sortByArvNumber(t).map(a=>[o.td(a.arv_number),o.tdDate(a.birthdate),o.tdDate(a.dispensation_date)]);return t.length<=0?o.td(0):o.tdLink(t.length,()=>this.drilldownAsyncRows(i,r,e))},setRows(t){const i=this.formatGender(t);for(const r in h){const e=h[r],a=this.cohort.Location;if(!n.isEmpty(this.cohort)&&e in this.cohort&&r){const s=this.cohort[e];this.total3hp=n.uniq([...this.total3hp,...s["3HP_new"][t],...s["3HP_prev"][t]]),this.totalIpt=n.uniq([...this.totalIpt,...s["6H_new"][t],...s["6H_prev"][t]]),this.rows.push([o.td(a),o.td(e),o.td(i),this.drilldown(s["3HP_new"][t],"".concat(e," ").concat(i,"s New on 3HP")),this.drilldown(s["6H_new"][t],"".concat(e," ").concat(i,"s New on 6H")),this.drilldown(s["3HP_prev"][t],"".concat(e," ").concat(i,"s Previously on 3HP")),this.drilldown(s["6H_prev"][t],"".concat(e," ").concat(i,"s Previously on 6H"))])}else this.rows.push([o.td(e),o.td(i),o.td(0),o.td(0)])}},validateReport(){const t={newly_initiated_on_3hp:{param:this.total3hp.length,check:(r,e)=>r!=e,error:(r,e)=>"\n                        Total newly initiated on <b>3HP(".concat(e,")</b> is not matching newly \n                        initiated on 3HP in Cohort report <b>(").concat(r,")</b>.\n                    ")},newly_initiated_on_ipt:{param:this.totalIpt.length,check:(r,e)=>r!=e,error:(r,e)=>"\n                        Total newly initiated on IPT <b>(".concat(e,")</b> is not matching \n                        newly initiated on IPT in Cohort report <b>(").concat(r,")</b>.\n                    ")}};this.mohCohort.validateIndicators(t,r=>this.errors=r)===-1&&(this.errors=["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}}});function $(t,i,r,e,a,s){const d=p("report-template"),l=p("ion-page");return w(),_(l,null,{default:f(()=>[P(d,{reportPrefix:"MoH",title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,config:{showIndex:!0},validationErrors:t.errors,showValidationStatus:t.showStatus,headerInfoList:t.headerList,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","validationErrors","showValidationStatus","headerInfoList","onReportConfiguration"])]),_:1})}const U=u(I,[["render",$]]);export{U as default};
