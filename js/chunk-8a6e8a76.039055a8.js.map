{"version":3,"sources":["webpack:///./node_modules/eslint-loader/index.js","webpack:///./src/services/drug_order_service.ts","webpack:///./src/apps/ART/services/prescription_service.ts"],"names":["RegimenService","Service","constructor","super","this","getJson","getProgramID","patientId","date","getSessionDate","DrugOrderService","orders","postJson","dispensations","map","order","patientID","pageSize","drugID","params","AdverseEffectsCategories","PrescriptionService","providerID","nextVisitInterval","fastTrack","regimenExtras","fastTrackMedications","hangingPills","medicationOrders","treatmentState","contraindications","sideEffects","tptPrescriptionCount","lastSideEffectDate","i","AppEncounterService","getCachedConceptName","getRegimens","getCustomIngridients","isEmpty","arvs","getCachedConceptID","includes","extras","getConceptsByCategory","extrasAvailable","concept_id","some","Boolean","regimenCode","patientWeight","weight","regimen","type","getConceptID","contraindication","getObs","obs","forEach","o","HisDate","toStandardHisFormat","obs_datetime","concept","value_coded","push","drugInduced","value_drug","res","count","getFirstValueCoded","isFastTrack","yes","meds","Object","values","getAll","pills","filter","value_numeric","drug_order","drug_inventory_id","getLastDrugsReceived","drugs","withDosages","data","drug","getDrugDosages","drug_id","dosage","name","units","am","noon","pm","frequency","Promise","all","req","allSideEffects","parseInt","parseFloat","toString","pillsPerDay","packSize","packs","roundedPacks","Math","round","morningTabs","eveningTabs","dose","dateObj","Date","setDate","getDate","pack_size","barcodes","tabs","e","drugName","id","calculateEquivalentDosage","calculateDateFromInterval","getInstructions","calculateDosage","getFirstValueText","reason","drugOrders","create","encounterID","response","saveValueTextObs","reasonForSwitch"],"mappings":"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","file":"js/chunk-8a6e8a76.039055a8.js","sourcesContent":["import { Service } from \"./service\";\n\nexport class RegimenService extends Service {\n    constructor() {\n        super()\n    } \n\n    static getAllArvRegimens() {\n        return this.getJson(`programs/${this.getProgramID()}/all_arv_regimens`)\n    }\n\n    static getRegimens(patientId: number) {\n        return this.getJson(`programs/${this.getProgramID()}/regimens`, {'patient_id': patientId})\n    }\n\n    static getCustomIngridients() {\n        return this.getJson(`programs/${this.getProgramID()}/custom_regimen_ingredients`)\n    }\n\n    static getCurrentRegimen(patientId: number, date=this.getSessionDate()) {\n        return this.getJson(`programs/${this.getProgramID()}/${patientId}`, {date})   \n    }\n}","import { DrugOrderInterface } from \"@/interfaces/DrugOrder\";\nimport { Service } from \"./service\";\n\nexport class DrugOrderService extends Service {\n    constructor() {\n        super()\n    }\n\n    static create(orders: DrugOrderInterface) {\n        return this.postJson('drug_orders', orders)\n    }\n\n    static updateDispensationOrders(orders: any) {\n        return this.postJson('dispensations', {\n            'program_id': this.getProgramID(),\n            dispensations: orders.map((order: any) => ({\n                'date': this.getSessionDate(),\n                'drug_order_id': order['order_id'],\n                'quantity': order['quantity']\n            }))\n        })\n    }\n\n    static getDrugOrderHistory(patientID: number) {\n        return this.getJson('drug_orders', { 'patient_id': patientID })\n    }\n\n    static getDrugOrders(patientID: number) {\n        return this.getJson('drug_orders', {\n            'patient_id': patientID,\n            'date': this.getSessionDate(),\n            'program_id': this.getProgramID()\n        })\n    }\n\n    static getAllDrugOrders(patientID: number, pageSize=1000) {\n        return this.getJson('drug_orders', {\n            'patient_id': patientID,\n            'program_id': Service.getProgramID(),\n            'page_size': pageSize\n        })\n    }\n\n    static getLastDrugsReceived(patientID: number) {\n        return this.getJson(`patients/${patientID}/last_drugs_received`, {\n            'date': this.getSessionDate(),\n            'program_id': this.getProgramID()\n        })\n    }\n\n    static getDrugDosages(patientID: number, drugID: number, date=this.getSessionDate()) {\n        const params = { 'drug_id': drugID, 'date': date }\n        return this.getJson(`programs/${this.getProgramID()}/patients/${patientID}/drug_doses`, params)\n    }\n\n    static getOrderByPatient(patientId: number, params: any) {\n        return this.getJson('/drug_orders', {\n            'patient_id': patientId,\n            'program_id': this.getProgramID(),\n            ...params\n        })\n    }\n\n}","import { DrugInterface } from \"@/interfaces/Drug\";\nimport { DrugOrderService } from \"@/services/drug_order_service\";\nimport { Observation } from \"@/interfaces/observation\";\nimport HisDate from \"@/utils/Date\"\nimport { RegimenService } from \"@/services/regimen_service\";\nimport { isEmpty } from \"lodash\"\nimport { AppEncounterService } from \"@/services/app_encounter_service\"\n\nexport enum AdverseEffectsCategories {\n    CONTRAINDICATION = \"contraindication\",\n    SIDE_EFFECT = \"side_effect\"\n}\n\nexport class PrescriptionService extends AppEncounterService {\n    nextVisitInterval: number;\n    fastTrack: boolean;\n    regimenExtras: Array<Record<string, any>>;\n    hangingPills: Array<Record<string, any>>;\n    fastTrackMedications: Array<Record<string, any>>;\n    medicationOrders: Array<number>;\n    treatmentState: string;\n    contraindications: Record<string, any>;\n    sideEffects: Record<string, any>;\n    tptPrescriptionCount: number;\n    lastSideEffectDate: string;\n\n    constructor(patientID: number, providerID: number) {\n        super(patientID, 25, providerID) //TODO: Use encounter type reference name\n        this.nextVisitInterval = 0\n        this.fastTrack = false\n        this.regimenExtras = []\n        this.fastTrackMedications = []\n        this.hangingPills = []\n        this.medicationOrders = []\n        this.treatmentState = ''\n        this.contraindications = {}\n        this.sideEffects = {}\n        this.tptPrescriptionCount = 0\n        this.lastSideEffectDate = ''\n    }\n\n    setNextVisitInterval(nextVisitInterval: number) {\n        this.nextVisitInterval = nextVisitInterval\n    }\n\n    getHangingPills() {\n        return this.hangingPills\n    }\n\n    getMedicationOrders() {\n        return this.medicationOrders.map((i: number) => {\n            return AppEncounterService.getCachedConceptName(i)\n        })\n    }\n\n    getTptPrescriptionCount() {\n        return this.tptPrescriptionCount\n    }\n\n    getLastSideEffectDate() {\n        return this.lastSideEffectDate\n    }\n\n    getContraindications() { return this.contraindications }\n\n    getSideEffects() { return this.sideEffects }\n\n    getRegimenExtras() { return this.regimenExtras }\n\n    getPatientRegimens() { return RegimenService.getRegimens(this.patientID) }\n\n    getCustomIngridients() { return RegimenService.getCustomIngridients() }\n\n    getFastTrackMedications() { return this.fastTrackMedications }\n\n    getTreatmentState() { return this.treatmentState }\n\n    isFastTrack() { return this.fastTrack }\n\n    medicationOrdersAvailable() { return !isEmpty(this.medicationOrders) }\n\n    shouldPrescribeArvs() { \n        const arvs = AppEncounterService.getCachedConceptID(\"Antiretroviral drugs\")\n        return this.medicationOrders.includes(arvs)\n    }\n\n    shouldPrescribeExtras() {\n        const extras = AppEncounterService.getConceptsByCategory('art_extra_medication_order')\n        const extrasAvailable = extras.map((i: any) => this.medicationOrders.includes(i.concept_id))\n        return extrasAvailable.some(Boolean)\n    }\n\n    getRegimenStarterpack(regimenCode: number, patientWeight: number) {\n        const params = { weight: patientWeight, regimen: regimenCode }\n\n        return AppEncounterService.getJson(\n            `programs/${AppEncounterService.getProgramID()}/regimen_starter_packs`,\n            params\n        )\n    }\n\n    async getLvpDrugsByType(type: string, regimen: number) {\n        return AppEncounterService.getJson(\n            `programs/${AppEncounterService.getProgramID()}/regimens/${regimen}`,\n            {\n                'patient_id': this.patientID,\n                'lpv_drug_type': type\n            }\n        )\n    }\n\n    async loadContraindications() {\n        const contraindication = await AppEncounterService.getConceptID('Contraindications')\n        const obs = await AppEncounterService.getObs({\n            'concept_id': contraindication, 'person_id': this.patientID \n        })\n\n        obs.forEach((o: any) => {\n            const date = HisDate.toStandardHisFormat(o.obs_datetime)\n\n            if (!this.contraindications[date]) this.contraindications[date] = []\n\n            const concept = AppEncounterService.getCachedConceptName(o.value_coded)\n\n            this.contraindications[date].push(concept)\n        })\n    }\n\n    async loadDrugInduced() {\n        const drugInduced = await AppEncounterService.getConceptID('Drug induced')\n        const obs = await AppEncounterService.getObs({\n            'concept_id': drugInduced, 'person_id': this.patientID \n        })\n\n        if (!obs) return\n\n        obs.forEach((o: any) => {\n            const date = HisDate.toStandardHisFormat(o.obs_datetime)\n\n            if (!this.lastSideEffectDate) this.lastSideEffectDate = date\n\n            if (!o.value_drug || !o.value_coded) return\n\n            if (!this.sideEffects[date]) this.sideEffects[date] = {}\n\n            if (!this.sideEffects[date][o.value_drug]) this.sideEffects[date][o.value_drug] = []\n\n            const concept = AppEncounterService.getCachedConceptName(o.value_coded)\n\n            this.sideEffects[date][o.value_drug].push(concept)\n        })\n    }\n\n    async loadTptPrescriptionCount() {\n        const res = await AppEncounterService.getJson(\n            `tpt_prescription_count`, {\n                'patient_id': this.patientID,\n                'date': this.date\n            }\n        )\n\n        if (res) {\n            const count = res.count + 1\n            this.tptPrescriptionCount = count > 3 ? 3 : count\n        } \n    }\n\n    async loadFastTrackStatus() {\n        const isFastTrack = await AppEncounterService.getFirstValueCoded(this.patientID, 'Fast track')\n        const yes = await AppEncounterService.getConceptID('yes')\n\n        if (isFastTrack) this.fastTrack = isFastTrack === yes\n    }\n    \n    async loadRegimenExtras(date=this.date) {\n        const meds = await RegimenService.getJson(\n            `programs/${RegimenService.getProgramID()}/patients/${this.patientID}/dosages`,\n            {date}\n        )\n        if (meds) this.regimenExtras = Object.values(meds)\n    }\n\n    async loadMedicationOrders() {\n        const medicationOrders = await AppEncounterService.getConceptID(\"Medication orders\")\n        const orders = await AppEncounterService.getObs({\n            'concept_id': medicationOrders,\n            'date': this.date,\n            'person_id': this.patientID,\n            'page_size': 5\n        })\n        this.medicationOrders = orders.map((i: Observation) => i.value_coded)\n    }\n\n    async loadHangingPills() {\n        const pills = await AppEncounterService.getAll(this.patientID, 'Pills brought')\n        if (pills) {\n            this.hangingPills = pills.filter((o: any) => o.value_numeric >= 1 && o.order)\n                                    .map((o: any) => o.order.drug_order.drug_inventory_id)\n        }\n    }\n\n    async loadFastTrackMedications() {\n        const drugs = await DrugOrderService.getLastDrugsReceived(this.patientID)\n        const withDosages = drugs.map(async(data: any) => {\n            const { drug } = data\n            const dosage = await DrugOrderService.getDrugDosages(this.patientID, drug.drug_id)\n            return {\n                'drug_id': drug.drug_id,\n                'drug_name': drug.name,\n                'units': drug.units,\n                'am': dosage.am,\n                'noon': dosage.noon,\n                'pm': dosage.pm,\n                'frequency': data.frequency\n            }\n        })\n        this.fastTrackMedications = await Promise.all(withDosages)\n    }\n\n    async loadTreatmentState() {\n        const params = { date: this.date }\n\n        const req = await AppEncounterService.getJson(\n            `programs/${AppEncounterService.getProgramID()}/patients/${this.patientID}/status`,\n            params\n        )\n\n        if (req) this.treatmentState = req['status']\n    }\n\n    findAndGroupDrugSideEffects(drugs: Array<number>) {\n        const allSideEffects: any = {}\n\n        for (const date in this.sideEffects) {\n            const drugInduced = this.sideEffects[date]\n\n            for(const drug in drugInduced) {\n                if (!drugs.includes(parseInt(drug))) continue\n\n                if (!allSideEffects[date]) allSideEffects[date] = []\n\n                allSideEffects[date] = [\n                    ...allSideEffects[date], ...drugInduced[drug]\n                ]\n            }\n        }\n        return allSideEffects\n    }\n\n    calculatePillsPerDay(am: number, noon: number, pm: number) {\n        return parseFloat(am.toString()) + noon + pm\n    }\n\n    estimatePackSize(pillsPerDay: number, packSize=0) {\n        const packs = (pillsPerDay * this.nextVisitInterval) / packSize\n        \n        let roundedPacks = Math.round(packs)\n\n        if (roundedPacks <= 0) roundedPacks += 1\n\n        return roundedPacks\n    }\n\n    calculateDosage(morningTabs: number, eveningTabs: number): number {\n        let dose = 0\n        if (eveningTabs === 0) dose = morningTabs\n\n        if (morningTabs == 0) dose = eveningTabs\n\n        if (morningTabs > 0 && eveningTabs  > 0) {\n            dose = (morningTabs + eveningTabs) / 2\n        }\n        return dose\n    }\n    \n    calculateEquivalentDosage(morningTabs: number, eveningTabs: number): number {\n        return morningTabs + eveningTabs\n    }\n\n    calculateDateFromInterval() {\n        const dateObj = new Date(this.date)\n        dateObj.setDate(dateObj.getDate() + this.nextVisitInterval)\n        return HisDate.toStandardHisFormat(dateObj)\n    }\n\n    getDrugPackSize(drug: any) {\n        if (drug.pack_size) return drug.pack_size\n        try{\n            return drug.barcodes[0].tabs\n        }catch(e) {\n            return 30\n        }\n    }\n\n    getInstructions(drugName: string, morningTabs: number, eveningTabs: number, units: string): string {\n        return `${drugName} :- Morning: ${morningTabs} ${units}, Evening: ${eveningTabs} ${units}`\n    }\n\n    toOrderObj(id: number, name: string, units: string, am=0, pm=0, frequency=''): DrugInterface {\n        return {\n            'drug_inventory_id': id,\n            'equivalent_daily_dose': this.calculateEquivalentDosage(am, pm),\n            'start_date': this.date,\n            'auto_expire_date': this.calculateDateFromInterval(), \n            'units': units,\n            'instructions': this.getInstructions(name, am, pm, units),\n            'dose': this.calculateDosage(am, pm),\n            'frequency': frequency\n        }\n    }\n\n    async getReasonForRegimenSwitch() {\n        const reason = await AppEncounterService.getFirstValueText(this.patientID, 'Reason for ARV switch')\n        return reason ? reason : 'N/A'\n    }\n\n    async createDrugOrder(drugOrders: Array<DrugInterface>) {\n        return DrugOrderService.create({\n            'encounter_id': this.encounterID,\n            'drug_orders': drugOrders\n        })\n    }\n\n    async createHangingPillsObs(response: string) {\n        return this.saveValueTextObs('appointment type', response)\n    }\n\n    async createRegimenSwitchObs(reasonForSwitch: string): Promise<Observation> {\n        return this.saveValueTextObs('Reason for ARV switch', reasonForSwitch)\n    }\n}\n"],"sourceRoot":""}