(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03bca019"],{"0a4b":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var s=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(s,{onOnIndex:t[1]||(t[1]=function(t){return e.fieldComponent=""}),skipSummary:!0,activeField:e.fieldComponent,fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:"/patient/dashboard/".concat(e.patientData.id)},null,8,["activeField","fields","onFinishAction","cancelDestinationPath"])}var i=n("5530"),o=n("1da1"),s=(n("99af"),n("d3b7"),n("159b"),n("b64b"),n("caad"),n("2532"),n("b0c0"),n("d81d"),n("ac1f"),n("466d"),n("a4d30"),n("e01a"),n("841c"),n("96cf"),n("d95e")),u=n("7920"),c=n("b446"),d=n("2706"),l=n("23e6"),h=n("9283"),f=n("d4ec"),p=n("bee2"),g=n("45eb"),m=n("7e84"),b=n("262e"),v=n("2caf"),_=n("1c74"),D=function(e){Object(b["a"])(n,e);var t=Object(v["a"])(n);function n(){return Object(f["a"])(this,n),t.call(this)}return Object(p["a"])(n,null,[{key:"voidRelation",value:function(e,t,n){return _["e"].void("people/".concat(e,"/relationships/").concat(t),{reason:n})}},{key:"amendRelation",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t,r,a,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.voidRelation(t,a,"Updating guardian relationship");case 2:return e.abrupt("return",n.createRelation(t,r,i));case 3:case"end":return e.stop()}}),e)})));function t(t,n,r,a){return e.apply(this,arguments)}return t}()},{key:"getRelations",value:function(){return Object(g["a"])(Object(m["a"])(n),"getJson",this).call(this,"types/relationships")}},{key:"createRelation",value:function(e,t,r){return Object(g["a"])(Object(m["a"])(n),"postJson",this).call(this,"people/".concat(e,"/relationships"),{relationship_type_id:r,relation_id:t})}}]),n}(_["e"]),R=n("2ef0"),y=n("80b5"),F=n("1f9a"),x=n("0fa1"),w=n("b5e4"),k=n("7def"),A=n("7f35"),C=n("8734"),E=n("76df"),O=Object(r["defineComponent"])({components:{HisStandardForm:u["a"]},data:function(){return{patientData:{},guardianData:{},fieldAction:"",fieldComponent:"",fields:[],form:{},redirectURL:"",activeField:"",currentAddressAttributes:["current_region","current_district","current_village","current_traditional_authority"],homeAddressAttributes:["home_region","home_district","home_traditional_authority","home_village"]}},watch:{$route:{handler:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.params,a=e.query,!r.patient_id){n.next=6;break}return n.next=4,l["a"].findByID(r.patient_id);case 4:i=n.sent,i&&(t.patientData=y["a"].mapPersonData(i.person),a.edit_guardian&&(t.fieldAction="edit"),t.fields=t.getFields());case 6:a.source&&(t.redirectURL=a.source);case 7:case"end":return n.stop()}}),n)})))()},immediate:!0,deep:!0}},methods:{getFields:function(){var e=[];return e.push(this.guardianSelection()),e.push(this.guardianIndex()),e.push(this.scanGuardian()),e.push(this.givenNameField()),e.push(this.familyNameField()),e.push(this.genderField()),e.push(this.searchResultField()),e=e.concat(this.dobFields()),e.push(this.homeRegionField()),e.push(this.homeDistrictField()),e.push(this.homeTAField()),e.push(this.homeVillageField()),e.push(this.currentRegionField()),e.push(this.currentDistrictField()),e.push(this.currentTAField()),e.push(this.currentVillage()),e=e.concat(this.landmarkFields()),e.push(this.cellPhoneField()),e.push(this.relationsField()),e},onFinish:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,i,o,s,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.isEditMode()){r.next=17;break}if("relations"==n.activeField){r.next=9;break}return a=new F["a"],a.setPersonID(n.guardianData.id),r.next=6,a.updatePerson(y["a"].resolvePerson(t));case 6:Object.keys(t).forEach((function(e){var r;e in n.guardianData&&(n.guardianData[e]=(null===(r=t[e])||void 0===r?void 0:r.date)||t[e].person)})),r.next=14;break;case 9:if(null===(i=n.guardianData)||void 0===i||!i.relation){r.next=14;break}return r.next=12,D.amendRelation(n.patientData.id,n.guardianData.id,n.guardianData.relation.relationship_id,e.relations.other.relationship_type_id);case 12:o=r.sent,o&&(n.guardianData.relation=o);case 14:n.fieldComponent="guardian_index",r.next=42;break;case 17:if(!n.isSameAsPatient(t)){r.next=21;break}Object(w["e"])("Guardian cannot be the same patient"),r.next=42;break;case 21:if(s=-1,!n.isRegistrationMode()){r.next=29;break}return u=new F["a"],r.next=26,u.registerGuardian(y["a"].resolvePerson(t));case 26:s=u.getPersonID(),r.next=30;break;case 29:s=n.guardianData.id;case 30:return r.next=32,D.createRelation(n.patientData.id,s,e.relations.other.relationship_type_id);case 32:if(!n.redirectURL){r.next=36;break}n.$router.push({name:n.redirectURL}),r.next=42;break;case 36:if(!n.$route.query.edit_guardian){r.next=40;break}n.fieldComponent="select_guardian",r.next=42;break;case 40:return r.next=42,Object(x["b"])(n.patientData.id,n.$router,n.$route);case 42:case"end":return r.stop()}}),r)})))()},isEditMode:function(){return"edit"===this.fieldAction},isSearchMode:function(){return["Search","Registration"].includes(this.fieldAction)},isRegistrationMode:function(){return"Registration"===this.fieldAction},canEdit:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.isEditMode()?e.includes(this.activeField)&&n:t},isSameAsPatient:function(e){var t="",n="",r="";return this.isRegistrationMode()?(t=h["b"].toStandardHisDisplayFormat(e.birth_date.date),n=e.given_name.person&&e.family_name.person,r=e.gender.person):(t=this.guardianData.birth_date,n=this.guardianData.name,r=this.guardianData.gender),n.toLowerCase()===this.patientData.name.toLowerCase()&&t===this.patientData.birth_date&&r===this.patientData.gender},guardianSelection:function(){var e=this;return{id:"select_guardian",helpText:"Select guardian to edit/view",type:s["b"].TT_SELECT,condition:function(){return e.isEditMode()},validation:function(e){return d["a"].required(e)},options:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,k["a"].getRelationships(e.patientData.id);case 2:if(n=t.sent,Object(R["isEmpty"])(n)){t.next=7;break}return t.abrupt("return",n.map((function(e){var t=y["a"].mapPersonData(e.relation);return{label:"".concat(t.name," (").concat(e.type.b_is_to_a,")"),value:e.relation.person_id,other:{relations:e,details:t}}})));case 7:return t.next=9,Object(C["a"])(450);case 9:return t.next=11,Object(A["a"])("Patient has no guardians","","Select option to proceed",[{name:"Cancel",slot:"start",color:"danger"},{name:"Register new",slot:"start",color:"success"}]);case 11:r=t.sent,"Register new"===r?(e.guardianData={},e.fieldAction="Registration",e.fieldComponent="scan"):e.$router.back();case 13:return t.abrupt("return",[]);case 14:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),config:{footerBtns:[{name:"New Guardian",slot:"end",color:"primary",onClick:function(){e.guardianData={},e.fieldAction="Registration",e.fieldComponent="scan"}}]}}},getDefaultVal:function(e){try{return this.guardianData[e]}catch(t){return""}},guardianIndex:function(){var e=this;return{id:"guardian_index",helpText:"Guardian details",type:s["b"].TT_TABLE_VIEWER,condition:function(e){return e.select_guardian.value},options:function(t){e.guardianData&&e.guardianData.id!=t.select_guardian.value&&(e.guardianData=Object(i["a"])(Object(i["a"])({},t.select_guardian.other.details),{},{relation:t.select_guardian.other.relations}));var n=function(t){return{name:"Edit",type:"button",action:function(){e.activeField=t,e.fieldComponent=e.activeField}}},r=[["Given Name",e.guardianData.given_name,n("given_name")],["Family Name",e.guardianData.family_name,n("family_name")],["Gender",e.guardianData.gender,n("gender")],["Birthdate",h["b"].toStandardHisDisplayFormat(e.guardianData.birth_date),n("year_birth_date")],["Cell Phone Number",e.guardianData.cell_phone_number,n("cell_phone_number")],["Home District",e.guardianData.home_district,n("home_region")],["Home TA",e.guardianData.home_traditional_authority,n("home_region")],["Home Village",e.guardianData.home_village,n("home_region")],["Current district",e.guardianData.current_district,n("current_region")],["Current T/A",e.guardianData.current_traditional_authority,n("current_region")],["Landmark",e.guardianData.landmark,n("default_landmarks")],["Relation",e.guardianData.relation.type.b_is_to_a,n("relations")]];return[{label:"",value:"",other:{rows:r}}]},config:{overrideDefaultFooterBtns:{nextBtn:{name:"Finish",slot:"end",color:"success",onClick:function(){return e.fieldComponent="select_guardian"}}},footerBtns:[{name:"Void Relation",slot:"start",color:"danger",onClick:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Object(E["a"])(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,D.voidRelation(e.patientData.id,e.guardianData.relation.relationship_id,n);case 2:e.fieldComponent="select_guardian";case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()}],hiddenFooterBtns:["Clear","Back"]}}},givenNameField:function(){var e=this,t=y["a"].getGivenNameField();return t.helpText="Guardian First name",t.defaultValue=function(){return e.getDefaultVal(t.id)},t.condition=function(){return e.canEdit([t.id],e.isSearchMode())},t},familyNameField:function(){var e=this,t=y["a"].getFamilyNameField();return t.helpText="Guardian Last name",t.defaultValue=function(){return e.getDefaultVal(t.id)},t.condition=function(){return e.canEdit([t.id],e.isSearchMode())},t},genderField:function(){var e=this,t=y["a"].getGenderField();return t.defaultValue=function(){return e.getDefaultVal(t.id)},t.condition=function(){return e.canEdit([t.id],e.isSearchMode())},t},dobFields:function(){var e=this,t=y["a"].getDobConfig();return t.defaultValue=function(){return e.getDefaultVal("birth_date")},t.condition=function(){return e.canEdit(["year_birth_date","month_birth_date","day_birth_date"],e.isRegistrationMode())},Object(c["b"])(t)},homeRegionField:function(){var e=this,t=y["a"].getHomeRegionField();return t.condition=function(){return e.canEdit(e.homeAddressAttributes,e.isRegistrationMode())},t},homeDistrictField:function(){var e=this,t=y["a"].getHomeDistrictField();return t.condition=function(){return e.canEdit(e.homeAddressAttributes,e.isRegistrationMode())},t},homeTAField:function(){var e=this,t=y["a"].getHomeTaField();return t.condition=function(t){return e.canEdit(e.homeAddressAttributes,e.isRegistrationMode()&&!t.home_region.label.match(/foreign/i),!t.home_region.label.match(/foreign/i))},t},homeVillageField:function(){var e=this,t=y["a"].getHomeVillageField();return t.condition=function(t){return e.canEdit(e.homeAddressAttributes,e.isRegistrationMode()&&!t.home_region.label.match(/foreign/i),!t.home_region.label.match(/foreign/i))},t},currentRegionField:function(){var e=this,t=y["a"].getCurrentRegionField();return t.condition=function(){return e.canEdit(e.currentAddressAttributes,e.isRegistrationMode())},t},currentDistrictField:function(){var e=this,t=y["a"].getCurrentDistrictField();return t.condition=function(){return e.canEdit(e.currentAddressAttributes,e.isRegistrationMode())},t},currentTAField:function(){var e=this,t=y["a"].getCurrentTAfield();return t.condition=function(t){return e.canEdit(e.currentAddressAttributes,e.isRegistrationMode()&&!t.current_region.label.match(/foreign/i),!t.current_region.label.match(/foreign/i))},t},currentVillage:function(){var e=this,t=y["a"].getCurrentVillageField();return t.condition=function(t){return e.canEdit(e.currentAddressAttributes,e.isRegistrationMode()&&!t.current_region.label.match(/foreign/i),!t.current_region.label.match(/foreign/i))},t},cellPhoneField:function(){var e=this,t=y["a"].getCellNumberField();return t.condition=function(){return e.canEdit([t.id],e.isRegistrationMode())},t},landmarkFields:function(){var e=this,t=y["a"].getLandmarkFields(),n=t[0].proxyID||t[0].id;return t[0].defaultValue=function(){return e.getDefaultVal(n)},t[0].condition=function(){return e.canEdit([n],e.isRegistrationMode())},t},relationsField:function(){var e=this;return{id:"relations",helpText:"Select relationship type",type:s["b"].TT_RELATION_SELECTION,defaultValue:function(){return e.getDefaultVal("relations")},validation:function(e){return d["a"].required(e)},condition:function(){return e.canEdit(["relations"])},onload:function(t){if(t.patient=e.patientData,e.isRegistrationMode()){var n=y["a"].resolvePerson(t.cdata);t.guardian={name:"".concat(n.given_name," ").concat(n.family_name),birth_date:h["b"].toStandardHisDisplayFormat(n.birthdate),home_address:"".concat(n.home_district," ").concat(n.home_traditional_authority)}}else t.guardian=e.guardianData},options:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D.getRelations();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return{label:e.b_is_to_a,value:e.description,other:e}})));case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),config:{hiddenFooterBtns:["Clear"]}}},scanGuardian:function(){var e=this;return{id:"scan",helpText:"Scan or Register Guardian",type:s["b"].TT_BARCODE,requireNext:!1,condition:function(){return!e.isEditMode()},onValue:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].findByNpid(n);case 2:return r=t.sent,Object(R["isEmpty"])(r)||(e.guardianData=y["a"].mapPersonData(r[0].person),e.fieldComponent="relations",e.fieldAction="Scan"),t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Find or Register Guardian",color:"success",slot:"end",onClick:function(){e.fieldAction="Search",e.fieldComponent="given_name"}}]}}},searchResultField:function(){var e=this;return{id:"results",helpText:"Search results",type:s["b"].TT_PERSON_RESULT_VIEW,dynamicHelpText:function(e){return'Search results for \n                "'.concat(e.given_name.value," ").concat(e.family_name.value," | ").concat(e.gender.label,'"\n                ')},appearInSummary:function(){return!1},condition:function(){return e.isSearchMode()},validation:function(e){return d["a"].required(e)},options:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["a"].search({given_name:t.given_name.value,family_name:t.family_name.value,gender:t.gender.value});case 2:return n=e.sent,e.abrupt("return",n.map((function(e){return y["a"].getPersonAttributeOptions(e)})));case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Edit Search",slot:"end",onClick:function(){e.fieldAction="Search",e.fieldComponent="given_name"}},{name:"New Guardian",slot:"end",onClick:function(){e.fieldAction="Registration",e.fieldComponent="year_birth_date"}},{name:"Continue Guardian",color:"success",slot:"end",state:{disabled:{default:function(){return!0},onValue:function(e,t){return Object(R["isEmpty"])(t.results)}}},onClick:function(t){e.guardianData=y["a"].mapPersonData(t.results.other.person.person),e.fieldComponent="relations",e.fieldAction="Search"}}]}}}}}),j=n("6b0d"),P=n.n(j);const S=P()(O,[["render",a]]);t["default"]=S},"1f9a":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("1c74"),a=n("ad60"),i=n("d10e");class o extends r["e"]{constructor(){super()}static create(e){return super.postJson("/person_attributes",e)}}var s=n("4db7");class u extends r["e"]{constructor(){super(),this.personId=0}getPersonID(){return this.personId}setPersonID(e){this.personId=e}async registerPatient(e,t){await this.createPerson(e),await this.createPersonAttributes(t);const n=await this.createPatient();return await this.printPatient(),n}async registerGuardian(e){return this.createPerson(e)}updatePerson(e){return new i["a"](e).update(this.personId)}async createPerson(e){const t=await new i["a"](e).create();return this.personId=t.person_id,t}createPatient(){return a["a"].createPatient(this.personId)}async createPersonAttributes(e){for(const t in e)await o.create({...e[t],person_id:this.personId})}printPatient(){return new s["a"](this.personId).printNidLbl()}}},"76df":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("1da1"),a=(n("96cf"),n("7f35"));function i(e){return o.apply(this,arguments)}function o(){return o=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"action-sheet-modal",e.next=3,Object(a["c"])("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",n);case 3:if(r=e.sent,!r.selection||"Void"!==r.action){e.next=7;break}return e.next=7,t(r.selection);case 7:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}}}]);
//# sourceMappingURL=chunk-03bca019.7980c3a2.js.map