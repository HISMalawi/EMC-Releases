(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["TouchFormElement30","TouchFormElement8"],{"0a79":function(e,t,c){"use strict";var n=c("7a23");function o(e,t,c,o,a,s){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{id:"view-port",class:Object(n["normalizeClass"])(e.showFull?"":"half")},[Object(n["renderSlot"])(e.$slots,"default",{},void 0,!0)],2)}var a=Object(n["defineComponent"])({name:"ViewPort",props:{showFull:{type:Boolean,default:()=>!0}}}),s=(c("a4d3"),c("6b0d")),i=c.n(s);const r=i()(a,[["render",o],["__scopeId","data-v-7c293cad"]]);t["a"]=r},"0cb1":function(e,t,c){"use strict";c.d(t,"a",(function(){return o}));var n=c("cc6f");class o extends n["a"]{constructor(e,t){super(e,57,t)}}},1945:function(e,t,c){},"4b90":function(e,t,c){"use strict";c("1945")},"51c8":function(e,t,c){"use strict";c.r(t);var n=c("7a23"),o=Object(n["defineComponent"])({emits:["onValue","onFieldActivated"],props:{config:{type:Object,default:()=>({})},preset:{type:Object,default:()=>({label:"",value:""})},defaultValue:{type:Function},fdata:{type:Object,required:!0},cdata:{type:Object,required:!0},clear:{type:Number,required:!0},options:{type:Function,default:()=>[]},activationState:{type:String,default:""},onValue:{type:Function},onValueUpdate:{type:Function},footerButtonEvent:{type:Object}}});const a=o;t["default"]=a},"9f38":function(e,t,c){},a4d3:function(e,t,c){"use strict";c("a6f7")},a6f7:function(e,t,c){},bc14:function(e,t,c){"use strict";c("9f38")},c4e4:function(e,t,c){"use strict";var n=c("7a23");const o=e=>(Object(n["pushScopeId"])("data-v-16b4e887"),e=e(),Object(n["popScopeId"])(),e),a={class:"ion-margin-bottom"},s=o(()=>Object(n["createElementVNode"])("div",{class:"his-md-text side-title"}," Select specimen ",-1)),i={key:1},r={class:"his-md-text side-title"},l=o(()=>Object(n["createElementVNode"])("div",{class:"his-md-text side-title"}," Main test(s) reason ",-1)),d={style:{background:"lightyellow",height:"34vh"}},b={class:"his-sm-text"},O=o(()=>Object(n["createElementVNode"])("thead",null,[Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",null,"Test"),Object(n["createElementVNode"])("th",null,"Specimen"),Object(n["createElementVNode"])("th",null,"Reason"),Object(n["createElementVNode"])("th",null,"Action")])],-1));function u(e,t,c,o,u,p){const m=Object(n["resolveComponent"])("ion-title"),h=Object(n["resolveComponent"])("ion-icon"),j=Object(n["resolveComponent"])("ion-input"),v=Object(n["resolveComponent"])("ion-toolbar"),y=Object(n["resolveComponent"])("ion-header"),f=Object(n["resolveComponent"])("ion-label"),C=Object(n["resolveComponent"])("ion-checkbox"),V=Object(n["resolveComponent"])("ion-item"),N=Object(n["resolveComponent"])("ion-list"),w=Object(n["resolveComponent"])("ion-col"),x=Object(n["resolveComponent"])("ion-radio"),k=Object(n["resolveComponent"])("ion-radio-group"),g=Object(n["resolveComponent"])("ion-text"),E=Object(n["resolveComponent"])("BarcodeInput"),B=Object(n["resolveComponent"])("ion-button"),I=Object(n["resolveComponent"])("ion-row"),T=Object(n["resolveComponent"])("ion-grid"),_=Object(n["resolveComponent"])("his-keyboard"),S=Object(n["resolveComponent"])("ion-content"),F=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createVNode"])(y,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{class:"his-lg-text"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Lab orders ")]),_:1}),Object(n["createVNode"])(h,{size:"large",slot:"end",icon:e.searchIcon,color:e.searchColor},null,8,["icon","color"]),Object(n["createVNode"])(j,{readonly:!0,value:e.searchFilter,disabled:e.activeIndex&&!e.isOrderComplete,color:e.searchColor,onClick:t[0]||(t[0]=()=>e.showKeyboard=!e.showKeyboard),placeholder:"Search for tests",style:{"text-align":"left"},class:"input_display",slot:"end"},null,8,["value","disabled","color"])]),_:1})]),_:1}),Object(n["createVNode"])(S,{style:{overflow:"hidden",background:"grey",height:"70vh"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(T,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(I,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(w,{size:"6"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(N,{style:{overflowY:"auto",height:"75vh"}},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.testTypesOnDisplay,t=>(Object(n["openBlock"])(),Object(n["createBlock"])(V,{class:"his-sm-text",key:t.id,disabled:null!=e.activeIndex&&e.activeIndex!==t.id&&!e.isOrderComplete,detail:""},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,{"text-wrap":""},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.name),1)]),_:2},1024),Object(n["createVNode"])(C,{slot:"start",checked:t.isChecked,onIonChange:c=>e.onSelectTest(t.name,t.id,c)},null,8,["checked","onIonChange"])]),_:2},1032,["disabled"]))),128))]),_:1})]),_:1}),null!=e.activeIndex&&e.selectedOrders.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(w,{key:0,style:{overflowY:"auto",height:"79vh"}},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",a,[e.extendedLabsEnabled?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(N,{key:0},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(k,{modelValue:e.testTypes[e.activeIndex]["specimen"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.testTypes[e.activeIndex]["specimen"]=t)},{default:Object(n["withCtx"])(()=>[s,(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.specimens,t=>(Object(n["openBlock"])(),Object(n["createBlock"])(V,{key:t},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.name),1)]),_:2},1024),Object(n["createVNode"])(x,{slot:"start",value:t.name,onClick:c=>e.addSpecimen(t)},null,8,["value","onClick"])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})),e.dbsBarcodeActivated?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",i,[Object(n["createElementVNode"])("div",r,[Object(n["createTextVNode"])(" Barcode ID: "),Object(n["createVNode"])(g,{color:e.testTypes[e.activeIndex].accessionNumber?"success":"dark"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("b",null,Object(n["toDisplayString"])(e.testTypes[e.activeIndex].accessionNumber||"None"),1)]),_:1},8,["color"])]),Object(n["createVNode"])(E,{size:"small",onOnScan:t[2]||(t[2]=t=>e.onScanEIDbarcode(t))})])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(k,{modelValue:e.testTypes[e.activeIndex]["reason"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.testTypes[e.activeIndex]["reason"]=t)},{default:Object(n["withCtx"])(()=>[l,(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.testReasons,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(V,{class:"his-sm-text",key:e},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e),1)]),_:2},1024),Object(n["createVNode"])(x,{slot:"start",value:e},null,8,["value"])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),Object(n["createElementVNode"])("div",d,[Object(n["createElementVNode"])("table",b,[O,Object(n["createElementVNode"])("tbody",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.finalOrders,(t,c)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{key:c},[Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.name),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.specimen||"N/A"),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.reason),1),Object(n["createElementVNode"])("td",null,[Object(n["createVNode"])(B,{onClick:c=>e.removeOrder(t.id),slot:"end",color:"danger"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("X")]),_:2},1032,["onClick"])])]))),128))])])])]),_:1})):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1}),e.showKeyboard?(Object(n["openBlock"])(),Object(n["createBlock"])(_,{key:0,kbConfig:e.keyboardLayout,onKeyPress:e.onFilter,disabled:!1},null,8,["kbConfig","onKeyPress"])):Object(n["createCommentVNode"])("",!0)]),_:1}),Object(n["createVNode"])(F,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(B,{onClick:e.postActivities,size:"large",slot:"end",disabled:e.isPostingOrder||0===e.finalOrders.length},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Place orders ")]),_:1},8,["onClick","disabled"]),Object(n["createVNode"])(B,{disabled:e.isPostingOrder,onClick:t[4]||(t[4]=t=>e.closeModal([])),size:"large",slot:"start",color:"danger"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Close ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64)}var p=c("d867"),m=c("ff79"),h=c("b5e4"),j=c("9b7c"),v=c("0cb1"),y=c("b89f"),f=c("d1ca"),C=c("8e8b"),V=c("6be2"),N=c("2ef0"),w=c("efaf"),x=c("db10"),k=c("2345"),g=c("6062"),E=Object(n["defineComponent"])({name:"Modal",props:{activities:{type:Object,required:!0},testFilters:{type:Array},title:{type:String,default:""}},watch:{activities:{handler(e){e&&(this.appActivities=[...e],this.getActivities())},immediate:!0}},async created(){this.extendedLabsEnabled=await f["b"].extendedLabEnabled(),this.canScanDBS=await f["b"].canScanDBS()},methods:{onFilter(e){this.searchFilter=Object(k["a"])(e,this.searchFilter)},async onScanEIDbarcode(e){if(this.verifyingBarcode=!this.verifyingBarcode,!this.verifyingBarcode){if((await p["W"].create({message:"Checking "+e})).present(),this.testTypes[this.activeIndex]["accessionNumber"]=null,(""+(e||"")).length<=0)return Object(h["e"])("Barcode is required"),this.verifyingBarcode=!1,void p["W"].getTop().then(e=>e&&p["W"].dismiss());try{await j["a"].accessionNumExists(e)?Object(h["e"])(`Barcode ${e} was already used`):this.testTypes[this.activeIndex]["accessionNumber"]=e}catch(t){Object(h["c"])("Failed to confirm barcode "+e+", Please try again later",8e3)}this.verifyingBarcode=!1,p["W"].getTop().then(e=>e&&p["W"].dismiss())}},async onSelectTest(e,t,c){this.searchFilter="",this.showKeyboard=!1,this.testTypes[t]["isChecked"]=c.target.checked,this.testTypes[t]["isChecked"]?(this.activeIndex=t,this.specimens=await j["a"].getSpecimens(e)):this.removeOrder(t)},async getActivities(){const e=await j["a"].getTestTypes(),t=Object(N["findIndex"])(e,{name:"HIV viral load"}),c=-1!==t?e.splice(t,1):null,n=e.sort((e,t)=>(""+e.name).toUpperCase()>(""+t.name).toUpperCase()?1:-1).filter(e=>!Array.isArray(this.testFilters)||this.testFilters.includes(e.name));this.testTypes=(c?[...c,...n]:n).map((e,t)=>({...e,id:t}))},removeOrder(e){this.testTypes[e]["isChecked"]=!1,this.testTypes[e]["reason"]=null,this.testTypes[e]["specimen"]=null,this.testTypes[e]["specimenConcept"]=null,this.testTypes[e]["accessionNumber"]=null,this.activeIndex=null,this.specimens=[]},addSpecimen(e){this.testTypes[this.activeIndex]["specimenConcept"]=e.concept_id},async postActivities(){this.isPostingOrder=!0;try{const e=""+this.$route.params.patient_id,t=new v["a"](parseInt(e),-1),c=await t.createEncounter();if(c){const e=await j["a"].buildLabOrders(c,this.finalOrders),t=await j["a"].saveOrdersArray(c.encounter_id,e);if(!t)return Object(h["e"])("Unable to save lab orders");C["a"].invalidate("PATIENT_LAB_ORDERS");const n=await Object(h["a"])("Lab orders and encounter created!, print out your last orders?",{confirmBtnLabel:"Yes",cancelBtnLabel:"No"});n?await this.printOrders(t):await this.closeModal(t)}}catch(e){Object(h["e"])("Unable to save order: "+e)}this.isPostingOrder=!1},async closeModal(e){await p["X"].dismiss(e)},async printOrders(e){const t=new y["a"];await e.forEach(async e=>{const c="lab/labels/order?order_id="+e.order_id;await t.printLbl(c)}),await p["X"].dismiss(e)}},computed:{searchIcon(){return m["D"]},searchColor(){return this.showKeyboard?"primary":"dark"},testTypesOnDisplay(){if(this.searchFilter){const e=new g["a"](this.testTypes,{threshold:.3,keys:["name"],useExtendedSearch:!0});return e.search(this.searchFilter).map(e=>e.item)}return this.testTypes},dbsBarcodeActivated(){var e,t;return this.canScanDBS&&/dbs/i.test(""+(null===(e=this.testTypes[this.activeIndex])||void 0===e?void 0:e.specimen))&&/hiv viral load/i.test(""+(null===(t=this.testTypes[this.activeIndex])||void 0===t?void 0:t.name))},isOrderComplete(){return"number"==typeof this.activeIndex&&(!(this.dbsBarcodeActivated&&!this.testTypes[this.activeIndex]["accessionNumber"])&&(this.extendedLabsEnabled?!!this.testTypes[this.activeIndex]["reason"]:(this.testTypes[this.activeIndex]["specimenConcept"]||this.testTypes[this.activeIndex]["specimen"])&&this.testTypes[this.activeIndex]["reason"]))},selectedOrders(){return this.testTypes.filter(e=>!0===e.isChecked)},finalOrders(){return this.selectedOrders.filter(e=>!(this.dbsBarcodeActivated&&!e.accessionNumber)&&(e.reason&&(e.specimen&&!this.extendedLabsEnabled||this.extendedLabsEnabled)))},testReasons(){let e=this.reasons;return this.testTypes[this.activeIndex].name.match(/Viral load/i)&&(e=e.filter(e=>"Stat"!==e),e=e.concat(["Follow up after Low Level Viremia","Follow up after High Viral Load"])),e}},mounted(){this.getActivities()},data(){return{isPostingOrder:!1,searchFilter:"",showKeyboard:!1,keyboardLayout:V["h"],canScanDBS:!1,verifyingBarcode:!1,content:"Content",extendedLabsEnabled:!1,appActivities:[],testTypes:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}},components:{IonButton:p["d"],IonContent:p["n"],IonHeader:p["q"],IonTitle:p["R"],IonInput:p["v"],IonToolbar:p["S"],IonLabel:p["x"],IonList:p["y"],IonItem:p["w"],BarcodeInput:w["a"],IonCheckbox:p["k"],IonRadioGroup:p["F"],IonRow:p["H"],HisKeyboard:x["a"],IonIcon:p["r"]}}),B=(c("4b90"),c("6b0d")),I=c.n(B);const T=I()(E,[["render",u],["__scopeId","data-v-16b4e887"]]);t["a"]=T},e614:function(e,t,c){"use strict";c.r(t);var n=c("7a23");const o=e=>(Object(n["pushScopeId"])("data-v-356b70ce"),e=e(),Object(n["popScopeId"])(),e),a={class:"view-port-content"},s={class:"his-sm-text"},i=o(()=>Object(n["createElementVNode"])("tr",null,[Object(n["createElementVNode"])("th",null,"Accession #"),Object(n["createElementVNode"])("th",null,"Test Name"),Object(n["createElementVNode"])("th",null,"Specimen"),Object(n["createElementVNode"])("th",null,"Ordered"),Object(n["createElementVNode"])("th",null,"Result"),Object(n["createElementVNode"])("th",null,"Released"),Object(n["createElementVNode"])("th",null,"Given")],-1)),r=o(()=>Object(n["createElementVNode"])("br",null,null,-1));function l(e,t,c,o,l,d){const b=Object(n["resolveComponent"])("ion-button"),O=Object(n["resolveComponent"])("view-port");return Object(n["openBlock"])(),Object(n["createBlock"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",a,[Object(n["createElementVNode"])("table",s,[i,(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.rows,(t,c)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("tr",{key:c},[Object(n["createElementVNode"])("td",null,[Object(n["createVNode"])(b,{color:"light",fill:"none",onClick:c=>e.printOrder(t)},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.accession_number),1)]),_:2},1032,["onClick"])]),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.test_name),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.specimen),1),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.ordered),1),Object(n["createElementVNode"])("td",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(t.result,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:t},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e)+" ",1),r]))),128))]),Object(n["createElementVNode"])("td",null,Object(n["toDisplayString"])(t.released),1),Object(n["createElementVNode"])("td",null,[Object(n["createElementVNode"])("span",{style:Object(n["normalizeStyle"])("color: "+("Yes"===t.result_given?"green;":"black;"))},Object(n["toDisplayString"])(t.result_given),5)])]))),128))])])]),_:1})}var d=c("0a79"),b=c("d867"),O=c("c4e4"),u=c("2ef0"),p=c("51c8"),m=c("9283"),h=c("b5e4"),j=Object(n["defineComponent"])({components:{ViewPort:d["a"],IonButton:b["d"]},mixins:[p["default"]],data:()=>({HisDate:m["b"],rows:[]}),methods:{async init(){this.$emit("onFieldActivated",this);const e=await this.options(this.fdata),t=e[0].other.values;this.rows=t.map(e=>(e.id=e.order_id,e.ordered&&(e.ordered=m["b"].toStandardHisDisplayFormat(e.ordered)),e.released&&(e.released=m["b"].toStandardHisDisplayFormat(e.released)),e))},async printOrder(e){var t;if("function"===typeof(null===(t=this.config)||void 0===t?void 0:t.printOrder)){const t=await Object(h["a"])(`Do you want to print order with accession number ${e.accession_number}?`);t&&this.config.printOrder(e.id)}},formatOrders(e){return e.map(e=>({id:e.order_id,encounter_id:e.encounter_id,result_given:e.result_given,accession_number:e.accession_number,test_name:e.tests[0].name,specimen:e.specimen.name,ordered:m["b"].toStandardHisDisplayFormat(e.order_date),result:[],release:""}))},async launchOrderSelection(e=null){const t=await b["X"].create({component:O["a"],backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:e}});t.present();const{data:c}=await t.onDidDismiss();Object(u["isEmpty"])(c)||(this.rows=[...this.formatOrders(c),...this.rows])}},mounted(){this.init()},activated(){this.init()}}),v=(c("bc14"),c("6b0d")),y=c.n(v);const f=y()(j,[["render",l],["__scopeId","data-v-356b70ce"]]);t["default"]=f}}]);
//# sourceMappingURL=TouchFormElement30.5d3a6c1b.js.map