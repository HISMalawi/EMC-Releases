(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-242290d5"],{"9d38":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,c,u){var i=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(i,{skipSummary:!0,fields:e.fields,onFinishAction:e.onSubmit,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}var c=n("1da1"),u=(n("96cf"),n("fe96")),i=Object(r["defineComponent"])({mixins:[u["a"]],watch:{ready:{handler:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e&&(t.fields=t.getAdherenceFields());case 1:case"end":return n.stop()}}),n)})))()},immediate:!0}},methods:{onSubmit:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.saveAdherence();case 2:e.nextTask();case 3:case"end":return t.stop()}}),t)})))()}}}),o=n("6b0d"),s=n.n(o);const d=s()(i,[["render",a]]);t["default"]=d},fe96:function(e,t,n){"use strict";var r=n("5530"),a=n("2909"),c=n("1da1"),u=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("99af"),n("159b"),n("b0c0"),n("ac1f"),n("466d"),n("d81d"),n("7a23")),i=n("d95e"),o=n("b5e4"),s=n("d4ec"),d=n("bee2"),l=n("262e"),h=n("2caf"),p=(n("4de4"),n("caad"),n("2532"),n("25f0"),n("cc6f")),f=n("9283"),b=n("2ef0"),g=n("32b3"),v=n("5a0c"),m=n.n(v),O=function(e){Object(l["a"])(n,e);var t=Object(h["a"])(n);function n(e,r){var a;return Object(s["a"])(this,n),a=t.call(this,e,68,r),a.lastDrugs=[],a.lastReceiptDate="",a}return Object(d["a"])(n,[{key:"loadPreviousDrugs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,c=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new Date(this.date),t.setDate(t.getDate()-1),n=function(e){return f["b"].toStandardHisFormat(e)},e.next=5,p["a"].getJson("patients/".concat(this.patientID,"/drugs_received"),{date:n(t)});case 5:r=e.sent,r&&(this.lastReceiptDate=r.reduce((function(e,t){return!e||new Date(n(t.order.start_date))>new Date(e)?n(t.order.start_date):e}),null),a=g["a"].htnDrugReferences().map((function(e){return e.drug_id})),this.lastDrugs=r.filter((function(e){return!a.includes(e.drug["drug_id"])&&n(e.order.start_date)===c.lastReceiptDate})));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getReceiptDate",value:function(){return this.lastReceiptDate}},{key:"getLastDrugs",value:function(){return this.lastDrugs}},{key:"receivedDrugsBefore",value:function(){return!Object(b["isEmpty"])(this.lastDrugs)}},{key:"buildPillCountObs",value:function(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}},{key:"buildAdherenceObs",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p["a"].getConceptID("Drug adherence",!0);case 2:return a=e.sent,e.abrupt("return",{concept_id:a,value_numeric:r,value_drug:n,value_modifier:"%",order_id:t,person_id:this.patientID,obs_datetime:p["a"].getSessionDate()});case 4:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"isAdherenceGood",value:function(e){return e>=95&&e<=105}},{key:"calculateAdherence",value:function(e,t,n){return Math.round(100*(e-t)/(e-n))}},{key:"calculateExpected",value:function(e,t,n,r){var a="QW"===r?"week":"day",c=this.calcTimeElapsed(n,a);return e-c*parseFloat(t.toString())}},{key:"calcTimeElapsed",value:function(e,t){return m()(this.date).diff(e,t)}},{key:"calculateUnaccountedOrMissed",value:function(e,t){var n=parseFloat(e)-parseFloat(t);return n<0?-1*n+" missed":n+" unacc"}}]),n}(p["a"]),w=n("7365"),y=n("2706"),D=Object(u["defineComponent"])({mixins:[w["a"]],data:function(){return{adherence:{},drugObs:[],askReasonForPoorAdherence:!1,calculationAgreementObs:[]}},methods:{saveAdherence:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.adherence.createEncounter();case 2:return t.next=4,Promise.all([].concat(Object(a["a"])(e.drugObs),Object(a["a"])(e.calculationAgreementObs)));case 4:return n=t.sent,t.next=7,e.adherence.saveObservationList(n);case 7:if(r=t.sent,r){t.next=10;break}return t.abrupt("return",Object(o["e"])("Unable to save patient observations"));case 10:case"end":return t.stop()}}),t)})))()},buildAdherenceReport:function(e){var t=this,n=this.adherence.getReceiptDate(),r=this.adherence.calcTimeElapsed(n,"day"),a=" Last visit: ".concat(f["b"].toStandardHisDisplayFormat(n)," \n                (").concat(r," Days Elapsed)"),c=[{indexes:[0,3,6],class:"adherence-col-bg"}],u=[],i=[a],o=[["Prescription"],["Tabs given"],["Tabs per"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];return e.forEach((function(e,n){var r=t.formatFrequency(e.frequency),a=t.calcPillsExpected(e),c=t.adherence.calculateAdherence(e.quantity,e.pillsBrought,a),s=t.adherence.isAdherenceGood(c)?"Good adherence":"Explore problem",d=t.adherence.calculateUnaccountedOrMissed(a,e.pillsBrought);i.push(e.drug.name),o[0].push(""),o[1].push(e.quantity),o[2].push("".concat(e.equivalent_daily_dose," <b>").concat(r,"</b>")),o[3].push(""),o[4].push(a<0?0:a),o[5].push(e.pillsBrought),o[6].push(""),o[7].push(d),o[8].push("".concat(c,"%")),o[9].push(s),u.push({index:n+1,row:9,class:s.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})})),[{label:"Selected Medication",value:"Table",other:{columns:i,rows:o,rowColors:c,cellColors:u}}]},formatFrequency:function(e){return"".concat(e).match(/qod/i)?"QOD":"".concat(e).match(/weekly/i)?"QW":e},calcPillsExpected:function(e){return this.adherence.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,this.formatFrequency(e.frequency))},getAdherenceFields:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return[{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:i["b"].TT_ADHERENCE_INPUT,init:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.adherence=new O(e.patientID,e.providerID),t.next=3,e.adherence.loadPreviousDrugs();case 3:return t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(){return!t||e.adherence.receivedDrugsBefore()},validation:function(e){if(y["a"].required(e))return["No drugs available"];var t=e.map((function(e){return""===e.value}));return t.some(Boolean)?["Some values are missing"]:null},unload:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.drugObs=[],n.forEach(function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){var a,c,u,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=n.other,c=a.drug,u=a.order,i=Object(r["a"])(Object(r["a"])({},n.other),{},{pillsBrought:n.value}),o=e.adherence.calculateAdherence(i.quantity,i.pillsBrought,e.calcPillsExpected(i)),e.drugObs.push(e.adherence.buildAdherenceObs(u.order_id,c.drug_id,o)),e.drugObs.push(e.adherence.buildPillCountObs(u.order_id,n.value)),e.askReasonForPoorAdherence||(e.askReasonForPoorAdherence=!e.adherence.isAdherenceGood(i));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),options:function(t){return Object(b["isEmpty"])(t.pills_brought)?e.adherence.getLastDrugs().map((function(e){return{label:e.drug.name,value:"",other:Object(r["a"])({},e)}})):t.pills_brought}},{id:"adherence_report",helpText:"ART adherence",type:i["b"].TT_TABLE_VIEWER,condition:function(){return!t||e.adherence.receivedDrugsBefore()},options:function(t){return e.buildAdherenceReport(t.pills_brought.map((function(e){return Object(r["a"])(Object(r["a"])({},e.other),{},{pillsBrought:e.value})})))},config:{hiddenFooterBtns:["Clear"]}},{id:"agree_with_calculation",helpText:"Agree with adherence calculation",type:i["b"].TT_SELECT,condition:function(){return e.askReasonForPoorAdherence},validation:function(e){return y["a"].required(e)},unload:function(t){var n=t.value;e.calculationAgreementObs=[e.adherence.buildValueCoded("Reason for poor treatment adherence",n)]},options:function(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}}]}}});const k=D;t["a"]=k}}]);
//# sourceMappingURL=chunk-242290d5.b68d47b3.js.map